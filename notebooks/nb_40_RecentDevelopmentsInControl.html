

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta property="og:title" content="Introduction" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://aai-institute.github.io/notebooks/nb_40_RecentDevelopmentsInControl.html" />
<meta property="og:site_name" content="Python" />
<meta property="og:description" content="So far we have focused on deterministic systems with no noise or disturbances., In this part of the training, we will focus on stochastic systems and how MPC can be used to handle such systems., We..." />
<meta property="og:image:width" content="1146" />
<meta property="og:image:height" content="600" />
<meta property="og:image" content="https://aai-institute.github.io/tfl-training-machine-learning-control/_images/social_previews/summary_notebooks_nb_40_RecentDevelopmentsInControl_3e212126.png" />
<meta property="og:image:alt" content="So far we have focused on deterministic systems with no noise or disturbances., In this part of the training, we will focus on stochastic systems and how MPC..." />
<meta name="description" content="So far we have focused on deterministic systems with no noise or disturbances., In this part of the training, we will focus on stochastic systems and how MPC can be used to handle such systems., We..." />
<meta name="twitter:card" content="summary_large_image" />

    <title>Introduction &#8212; Machine Learning Control Training</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"loader": {"load": ["[tex]/configmacros"]}, "tex": {"packages": {"[+]": ["configmacros"]}, "macros": {"vect": ["{\\mathbf{\\boldsymbol{#1}} }", 1], "E": "{\\mathbb{E}}", "P": "{\\mathbb{P}}", "R": "{\\mathbb{R}}", "abs": ["{\\left| #1 \\right|}", 1], "simpl": ["{\\Delta^{#1} }", 1], "amax": "{\\text{argmax}}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/nb_40_RecentDevelopmentsInControl';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../apidocs/index.html" />
    <link rel="prev" title="Introduction" href="nb_20_ControlAndPlanning.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/transferlab-logo.svg" class="logo__image only-light" alt="Machine Learning Control Training - Home"/>
    <script>document.write(`<img src="../_static/transferlab-logo.svg" class="logo__image only-dark" alt="Machine Learning Control Training - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Machine Learning Control Training
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebook Pages</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="nb_10_Introduction.html">Introduction</a></li>




<li class="toctree-l1"><a class="reference internal" href="nb_20_ControlAndPlanning.html">Introduction</a></li>







<li class="toctree-l1 current active"><a class="current reference internal" href="#">Introduction</a></li>






</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Code</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../apidocs/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.control.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.control</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.control.utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.control.utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.control.shortest_path_problem.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.control.shortest_path_problem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.control.plots.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.control.plots</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.control.environment.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.control.environment</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.control.parameters.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.control.parameters</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.constants.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.constants</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.nb_utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.nb_utils</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/aai-institute/tfl-training-machine-learning-control/main?urlpath=tree/notebooks/nb_40_RecentDevelopmentsInControl.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/aai-institute/tfl-training-machine-learning-control" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aai-institute/tfl-training-machine-learning-control/edit/main/notebooks/nb_40_RecentDevelopmentsInControl.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aai-institute/tfl-training-machine-learning-control/issues/new?title=Issue%20on%20page%20%2Fnotebooks/nb_40_RecentDevelopmentsInControl.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/nb_40_RecentDevelopmentsInControl.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stochastic-optimal-control-problem">Stochastic Optimal Control Problem</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stochastic-predictive-control">Stochastic Predictive Control</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-design-challenges">Control Design Challenges</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#robust-mpc">Robust MPC</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-stage-mpc">Multi-Stage MPC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-inverted-pendulum">Example - Inverted Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model">Model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-states-and-control-inputs">Model, States and Control inputs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ode">ODE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controller">Controller</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#objective">Objective</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#constraints">Constraints</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-uncertainty">Parameter Uncertainty</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Setup</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-based-model-predictive-control">Learning-Based Model Predictive Control</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-the-system-dynamics">Learning the system dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stochastic-non-parametric-approaches">Stochastic non-parametric approaches</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-the-controller-design">Learning the controller design</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-driven-controller-learning">Performance-Driven Controller Learning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-from-demonstration-with-inverse-optimal-control">Learning from Demonstration with Inverse Optimal Control</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#safe-learning-in-robotics">Safe Learning in Robotics</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-constraints">Safety Constraints</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-level-iii-constraint-satisfaction-guaranteed">Safety level III: constraint satisfaction guaranteed.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-level-ii-constraint-satisfaction-with-high-probability">Safety level II: constraint satisfaction with high probability.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-level-i-constraint-satisfaction-encouraged">Safety level I: constraint satisfaction encouraged</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#safe-learning-control-approaches">Safe Learning Control Approaches</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-uncertain-dynamics-to-safely-improve-performance">Learning uncertain dynamics to safely improve performance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encouraging-safety-and-robustness-in-rl">Encouraging safety and robustness in RL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certifying-learning-based-control-under-dynamics-uncertainty">Certifying learning-based control under dynamics uncertainty</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-predictive-safety-filter">Model Predictive Safety Filter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">training_rl</span>
<span class="o">%</span><span class="n">set_random_seed</span> <span class="mi">12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;autoreload&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;load_ext&#39;</span><span class="p">,</span> <span class="s1">&#39;training_rl&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;set_random_seed&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)</span>

<span class="nn">File /tmp/code/.venv/lib/python3.11/site-packages/IPython/core/interactiveshell.py:2432,</span> in <span class="ni">InteractiveShell.run_line_magic</span><span class="nt">(self, magic_name, line, _stack_depth)</span>
<span class="g g-Whitespace">   </span><span class="mi">2430</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;local_ns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_scope</span><span class="p">(</span><span class="n">stack_depth</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2431</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2432</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2434</span> <span class="c1"># The code below prevents the output from being displayed</span>
<span class="g g-Whitespace">   </span><span class="mi">2435</span> <span class="c1"># when using magics with decorator @output_can_be_silenced</span>
<span class="g g-Whitespace">   </span><span class="mi">2436</span> <span class="c1"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="g g-Whitespace">   </span><span class="mi">2437</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">magic</span><span class="o">.</span><span class="n">MAGIC_OUTPUT_CAN_BE_SILENCED</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>

<span class="nn">File /tmp/code/.venv/lib/python3.11/site-packages/IPython/core/magics/extension.py:33,</span> in <span class="ni">ExtensionMagics.load_ext</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">module_str</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>     <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s1">&#39;Missing module name.&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">33</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">extension_manager</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="s1">&#39;already loaded&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The </span><span class="si">%s</span><span class="s2"> extension is already loaded. To reload it, use:&quot;</span> <span class="o">%</span> <span class="n">module_str</span><span class="p">)</span>

<span class="nn">File /tmp/code/.venv/lib/python3.11/site-packages/IPython/core/extensions.py:76,</span> in <span class="ni">ExtensionManager.load_extension</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Load an IPython extension by its module name.</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd"> Returns the string &quot;already loaded&quot; if the extension is already loaded,</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd"> &quot;no load function&quot; if the module doesn&#39;t have a load_ipython_extension</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span><span class="sd"> function, or None if it succeeded.</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">76</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_extension</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>     <span class="k">if</span> <span class="n">module_str</span> <span class="ow">in</span> <span class="n">BUILTINS_EXTS</span><span class="p">:</span>

<span class="nn">File /tmp/code/.venv/lib/python3.11/site-packages/IPython/core/extensions.py:91,</span> in <span class="ni">ExtensionManager._load_extension</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>     <span class="k">if</span> <span class="n">module_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">91</span>         <span class="n">mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>     <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_str</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_load_ipython_extension</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>

<span class="nn">File /opt/conda/lib/python3.11/importlib/__init__.py:126,</span> in <span class="ni">import_module</span><span class="nt">(name, package)</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>             <span class="k">break</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>         <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="ne">--&gt; </span><span class="mi">126</span> <span class="k">return</span> <span class="n">_bootstrap</span><span class="o">.</span><span class="n">_gcd_import</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">level</span><span class="p">:],</span> <span class="n">package</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1204,</span> in <span class="ni">_gcd_import</span><span class="nt">(name, package, level)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1176,</span> in <span class="ni">_find_and_load</span><span class="nt">(name, import_)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1140,</span> in <span class="ni">_find_and_load_unlocked</span><span class="nt">(name, import_)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;training_rl&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">presentation_style</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UsageError: Line magic function `%presentation_style` not found.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_latex_macros</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UsageError: Line magic function `%load_latex_macros` not found.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">autoreload</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="kn">import</span> <span class="nn">casadi</span>
<span class="kn">import</span> <span class="nn">do_mpc</span>
<span class="kn">import</span> <span class="nn">mediapy</span> <span class="k">as</span> <span class="nn">media</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">gymnasium</span> <span class="kn">import</span> <span class="n">Env</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">widgets</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">NDArray</span>

<span class="kn">from</span> <span class="nn">training_rl.control</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">create_inverted_pendulum_environment</span><span class="p">,</span>
    <span class="n">InvertedPendulumParameters</span><span class="p">,</span>
    <span class="n">animate_full_inverted_pendulum_simulation</span><span class="p">,</span>
    <span class="n">simulate_environment</span><span class="p">,</span>
    <span class="n">show_video</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="c1"># This is needed because inside docker the rendering of mujoco environments may not work.</span>
<span class="n">render_mode</span> <span class="o">=</span> <span class="s2">&quot;rgb_array&quot;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPLAY&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/code/.venv/lib/python3.11/site-packages/do_mpc/sysid/__init__.py:15: UserWarning: The ONNX feature is not available. Please install the full version of do-mpc to access this feature.
  warnings.warn(&#39;The ONNX feature is not available. Please install the full version of do-mpc to access this feature.&#39;)
/tmp/code/.venv/lib/python3.11/site-packages/do_mpc/opcua/__init__.py:14: UserWarning: The opcua feature is not available. Please install the full version of do-mpc to access this feature.
  warnings.warn(&#39;The opcua feature is not available. Please install the full version of do-mpc to access this feature.&#39;)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">19</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">NDArray</span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="kn">from</span> <span class="nn">training_rl.control</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">create_inverted_pendulum_environment</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">InvertedPendulumParameters</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">animate_full_inverted_pendulum_simulation</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="n">simulate_environment</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="n">show_video</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;training_rl&#39;
</pre></div>
</div>
</div>
</div>
<img src="_static/images/aai-institute-cover.svg" alt="Snow" style="width:100%;">
<div class="md-slide title">Recent Developments in Control Theory</div><section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>So far we have focused on deterministic systems with no noise or disturbances.</p></li>
<li><p>In this part of the training, we will focus on stochastic systems and how MPC can be used to handle such systems.</p></li>
<li><p>We will also see how MPC can leverage data through learning-based approaches.</p></li>
<li><p>Additionally, we will explore how MPC can be combined with Reinforcement Learning to improve systems’ safety.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="stochastic-optimal-control-problem">
<h1>Stochastic Optimal Control Problem<a class="headerlink" href="#stochastic-optimal-control-problem" title="Permalink to this heading">#</a></h1>
<p>The methods discussed in this part deal with the problem of controlling dynamical systems
that are subject to system constraints under uncertainty, which can affect numerous parts of the
problem formulation. The system dynamics in discrete-time is given by:</p>
<div class="math notranslate nohighlight">
\[
x_{k+1} = f_t(x_k, u_k, k, w_k, \theta_t)
\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_k \in \mathbf{R}^n\)</span> is the system state at time <span class="math notranslate nohighlight">\(k\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(u_k \in \mathbf{R}^n\)</span> is the applied input at time <span class="math notranslate nohighlight">\(k\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(w_k\)</span> describes a sequence of random variables corresponding to disturbances or process noise in the system, which are often assumed to be independent and identically distributed (i.i.d.).</p></li>
<li><p><span class="math notranslate nohighlight">\(\theta_t \sim \mathcal{Q}^{\theta_t}\)</span> is a random variable describing the parametric uncertainty of the system, which is therefore constant over time.</p></li>
<li><p>The subscript <span class="math notranslate nohighlight">\(t\)</span> is used to emphasize that these quantities represent the true system dynamics or true optimal control problem.</p></li>
</ul>
<p>The true problem therefore relates to the development of an optimal controller for a distribution of systems given by <span class="math notranslate nohighlight">\(\mathcal{Q}^{\theta_t}\)</span> under random disturbances <span class="math notranslate nohighlight">\(w_k\)</span>.</p>
<p>The optimality of the controller is defined with respect to a cost or objective function. In the
presence of random model uncertainties, the cost is often defined as the expectation of a sum of
potentially time-varying stage costs of the states and inputs over a possibly infinite horizon <span class="math notranslate nohighlight">\(T\)</span>:</p>
<div class="math notranslate nohighlight">
\[
J_t = E\left(\sum \limits_{k=0}^{T} g_t(x_k, u_k, k)\right),
\]</div>
<p>where the expected value is taken with respect to all random variables.</p>
<section id="stochastic-predictive-control">
<h2>Stochastic Predictive Control<a class="headerlink" href="#stochastic-predictive-control" title="Permalink to this heading">#</a></h2>
<p>The constrained stochastic optimal control problem can be formulated as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}\\
J_t^* = \displaystyle\min_{\pi_{k}} &amp; 
E\left[\sum\limits_{k=0}^{T} g_t(x_k, u_k, k)\right]
\\
\text{subject to} &amp; x_{k + 1}= f_t(x_k, u_k, k, w_k, \theta_t)
\\
&amp; u_k = \pi_k(x_0, \dots, x_k)\\
&amp; \bar{W} = [w_0, \dots, w_{N - 1}] \sim \mathcal{Q}^{\bar{W}}, \theta_t \sim \mathcal{Q}^{\theta_t}\\
&amp; P[\bar{X}] = [x_0, \dots, x_{N}] \in \bar{X}_j ) \ge p_j, \forall j = 1, \dots, n_{cx}\\
&amp; P[\bar{U}] = [u_0, \dots, u_{N - 1}] \in \bar{U}_j ) \ge p_j, \forall j = 1, \dots , n_{cu}\\
\end{array},
\end{split}\]</div>
<p>Optimizing over a sequence of control laws <span class="math notranslate nohighlight">\(\{\pi_k\}\)</span>, which can make use of all information in the
form of state measurements <span class="math notranslate nohighlight">\(x_k\)</span> up to time step <span class="math notranslate nohighlight">\(k\)</span>. Problems of this form are in
general very hard to solve, and direct efforts typically rely on some form of discretization in space
and approximate dynamic programming or reinforcement learning.</p>
<p>A notable exception, similar to what we have seen previously, is linear systems under additive noise and quadratic stage costs in the unconstrained setting, for which an exact solution, such as the standard linear quadratic regulator (LQR).</p>
<p>MPC approximates the previous problem by repeatedly solving a simplified version of the
problem initialized at the currently measured state <span class="math notranslate nohighlight">\(x_k\)</span> over a shorter horizon <span class="math notranslate nohighlight">\(N\)</span>
in a receding- horizon fashion.</p>
<p>We introduce the prediction model:</p>
<div class="math notranslate nohighlight">
\[
x_{i+1|k} = f(x_{i|k}, u_{i|k}, i + k, w_{i|k}, \theta),
\]</div>
<p>where <span class="math notranslate nohighlight">\(f\)</span> is the prediction dynamics. It typically aims at approximating the true dynamics but often differs, e.g.,
for computational reasons or because a succinct description of the true dynamics is unavailable.</p>
<p>We use the subscript <span class="math notranslate nohighlight">\(i|k\)</span> to emphasize predictive quantities, where, e.g., <span class="math notranslate nohighlight">\(x_{i|k}\)</span> is the i-step-ahead prediction of the state, initialized at <span class="math notranslate nohighlight">\(x_{0|k} = x_k\)</span>.</p>
<p>The most widespread MPC formulations of are nominal MPC schemes, which do not consider any uncertainties in the prediction model but instead rely exclusively on the compensation of uncertainties via feedback and by re-solving the problem at the next sampling instance.</p>
<p>In nominal MPC, the optimization can be performed over control sequences <span class="math notranslate nohighlight">\(U = [u_{0|k}, \dots , u_{N - 1|k}]\)</span> rather than policies, resulting in the constrained optimal control problem</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}\\
J^∗ &amp;= \displaystyle\min_{U} g_f(x_{N|k}, u_{N|k}, k + N) + \sum\limits_{i=0}^{N-1} g(x_{i|k}, u_{i|k}, i + k)\\
\text{subject to} &amp; x_{i+1|k} = f(x_{i|k}, u_{i|k}, i + k)\\
&amp; U = [u_{0|k}, \dots, u_{N|k}] \in U_j, \forall j = 1, \dots, n_{cu} \\
&amp; X = [x_{0|k}, \dots, x_{N|k}] \in X_j \forall j = 1, \dots, n_{cx} \\
&amp; x_{N|k} \in X_f\\
&amp; x_{0|k} = x_k\\
\end{array}.
\end{split}\]</div>
<p>The control law is then implicitly defined through the optimization problem as:</p>
<div class="math notranslate nohighlight">
\[
π^{\text{MPC}}(x_k, k) = u_{0|k}^*,
\]</div>
<p>where <span class="math notranslate nohighlight">\(u_{0|k}^*\)</span> is the first element of the computed optimal control sequence <span class="math notranslate nohighlight">\(U^∗\)</span>.</p>
</section>
<section id="control-design-challenges">
<h2>Control Design Challenges<a class="headerlink" href="#control-design-challenges" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Ensuring recursive feasibility and achieving optimality despite a short prediction horizon.</p></li>
<li><p>Satisfying input and state constraints in the presence of uncertainty.</p></li>
<li><p>Ensuring computational tractability by properly reformulating constraints and costs and parameterizing control. policies</p></li>
</ul>
<p>There is no systematic and universal solution to the third challenge, and often the chosen approach is application dependent. Fortunately, the first and second challenges can be addressed by using data.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="robust-mpc">
<h1>Robust MPC<a class="headerlink" href="#robust-mpc" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Robust MPC guarantees constraint satisfaction for all uncertain element realizations.</p></li>
<li><p>The model is split into a nominal part and additive uncertainty in a compact set.</p></li>
<li><p>The controller is designed to be robust against the uncertainty.</p></li>
<li><p>The MPC cost is typically optimized for the nominal system.</p></li>
</ul>
<section id="multi-stage-mpc">
<h2>Multi-Stage MPC<a class="headerlink" href="#multi-stage-mpc" title="Permalink to this heading">#</a></h2>
<p>The basic idea for the multi-stage approach is to consider various scenarios, where a scenario is defined by one possible realization of all uncertain parameters at every control instant within the horizon. The family of all considered discrete scenarios can be represented as a tree structure, called the scenario tree</p>
<center>
<figure>
    <img src="_static/images/40_multi_state_mpc.png" width="60%"/>
    <figcaption>
        Scenario tree representation of the uncertainty
evolution for multi-stage MPC.
    </figcaption>
</figure>
</center><ul class="simple">
<li><p>Each node in the tree denotes the possible state of the system at every prediction step.</p></li>
<li><p>The branches represent the different possible realizations of the uncertainty.</p></li>
<li><p>The initial state of the system forms the root node of the tree.</p></li>
<li><p>The root node branches into several nodes in the first stage depending on the number of vertex matrix pairs of the parametric uncertainty.</p></li>
<li><p>All the nodes in the first stage branch again in the second stage.</p></li>
<li><p>The sequence continues until the end of prediction horizon N to form the complete scenario tree.</p></li>
<li><p>A path from the root node to the leaf node represents a scenario.</p></li>
</ul>
</section>
<section id="example-inverted-pendulum">
<h2>Example - Inverted Pendulum<a class="headerlink" href="#example-inverted-pendulum" title="Permalink to this heading">#</a></h2>
<p>In a real system, usually the model parameters cannot be determined exactly, what represents an important source of uncertainty. In this example, we consider that the mass of the pendulum and that of the cart are not known precisely
and vary with respect to their nominal value.</p>
<section id="model">
<h3>Model<a class="headerlink" href="#model" title="Permalink to this heading">#</a></h3>
<section id="model-states-and-control-inputs">
<h4>Model, States and Control inputs<a class="headerlink" href="#model-states-and-control-inputs" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">do_mpc</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;continuous&quot;</span><span class="p">)</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">var_type</span><span class="o">=</span><span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">var_type</span><span class="o">=</span><span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;theta&quot;</span><span class="p">)</span>
<span class="n">dpos</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">var_type</span><span class="o">=</span><span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;velocity&quot;</span><span class="p">)</span>
<span class="n">dtheta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">var_type</span><span class="o">=</span><span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;dtheta&quot;</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">var_type</span><span class="o">=</span><span class="s2">&quot;_u&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Certain parameters</span>
<span class="n">ip_parameters</span> <span class="o">=</span> <span class="n">InvertedPendulumParameters</span><span class="p">()</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">l</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">gamma</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">g</span>
<span class="n">mu_p</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">mu_p</span>
<span class="n">mu_c</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">mu_c</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Certain parameters</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">ip_parameters</span> <span class="o">=</span> <span class="n">InvertedPendulumParameters</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">l</span>

<span class="ne">NameError</span>: name &#39;InvertedPendulumParameters&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncertain parameters</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;_p&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;_p&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ode">
<h4>ODE<a class="headerlink" href="#ode" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="o">-</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">dtheta</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu_c</span> <span class="o">*</span> <span class="n">dpos</span><span class="p">)</span>
    <span class="o">-</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">dtheta</span>
<span class="p">)</span>
<span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">l</span> <span class="o">-</span> <span class="n">m</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">ddtheta</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="o">-</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">dtheta</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu_c</span> <span class="o">*</span> <span class="n">dpos</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="o">-</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">dtheta</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">l</span> <span class="o">-</span> <span class="n">m</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">ddtheta</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

<span class="ne">NameError</span>: name &#39;g&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">m</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">dtheta</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu_c</span> <span class="o">*</span> <span class="n">dpos</span><span class="p">)</span>
    <span class="o">-</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">dtheta</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">l</span>
<span class="p">)</span>
<span class="n">denominator</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>
<span class="n">ddpos</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">m</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">dtheta</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu_c</span> <span class="o">*</span> <span class="n">dpos</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="o">-</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">dtheta</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">l</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">casadi</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">ddpos</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

<span class="ne">NameError</span>: name &#39;g&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="n">dpos</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;velocity&quot;</span><span class="p">,</span> <span class="n">ddpos</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;dtheta&quot;</span><span class="p">,</span> <span class="n">ddtheta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="n">dpos</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;velocity&quot;</span><span class="p">,</span> <span class="n">ddpos</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">model</span><span class="o">.</span><span class="n">set_rhs</span><span class="p">(</span><span class="s2">&quot;dtheta&quot;</span><span class="p">,</span> <span class="n">ddtheta</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;ddpos&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="setup">
<h4>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="nn">File /tmp/code/.venv/lib/python3.11/site-packages/do_mpc/model/_model.py:970,</span> in <span class="ni">Model.setup</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">968</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_rhs</span><span class="p">[</span><span class="n">rhs_i</span><span class="p">[</span><span class="s1">&#39;var_name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rhs_i</span><span class="p">[</span><span class="s1">&#39;expr&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">969</span>     <span class="n">_x_names</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">([</span><span class="n">rhs_i</span><span class="p">[</span><span class="s1">&#39;var_name&#39;</span><span class="p">]])</span>
<span class="ne">--&gt; </span><span class="mi">970</span> <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">_x_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Definition of right hand side (rhs) is incomplete. Missing: </span><span class="si">{}</span><span class="s1">. Use: set_rhs to define expressions.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_x_names</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">972</span> <span class="n">var_dict_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tvp</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">973</span> <span class="n">sym_struct_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">_x</span><span class="p">,</span> <span class="n">_w</span><span class="p">,</span> <span class="n">_v</span><span class="p">,</span> <span class="n">_u</span><span class="p">,</span> <span class="n">_z</span><span class="p">,</span> <span class="n">_p</span><span class="p">,</span> <span class="n">_tvp</span><span class="p">]</span>

<span class="ne">AssertionError</span>: Definition of right hand side (rhs) is incomplete. Missing: {&#39;dtheta&#39;, &#39;velocity&#39;}. Use: set_rhs to define expressions.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="controller">
<h3>Controller<a class="headerlink" href="#controller" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpc</span> <span class="o">=</span> <span class="n">do_mpc</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">MPC</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mpc</span> <span class="o">=</span> <span class="n">do_mpc</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">MPC</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="nn">File /tmp/code/.venv/lib/python3.11/site-packages/do_mpc/controller/_mpc.py:146,</span> in <span class="ni">MPC.__init__</span><span class="nt">(self, model, settings)</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="n">do_mpc</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span><span class="n">do_mpc</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LinearModel</span><span class="p">],</span> <span class="n">settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MPCSettings</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>     <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<span class="ne">--&gt; </span><span class="mi">146</span>     <span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s1">&#39;setup&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Model for MPC was not setup. After the complete model creation call model.setup().&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span>     <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">do_mpc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MPCData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>     <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;MPC&#39;</span>

<span class="ne">AssertionError</span>: Model for MPC was not setup. After the complete model creation call model.setup().
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">create_inverted_pendulum_environment</span><span class="p">()</span>
<span class="n">mpc_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;n_horizon&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;n_robust&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;t_step&quot;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
    <span class="s2">&quot;state_discretization&quot;</span><span class="p">:</span> <span class="s2">&quot;collocation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;collocation_type&quot;</span><span class="p">:</span> <span class="s2">&quot;radau&quot;</span><span class="p">,</span>
    <span class="s2">&quot;collocation_deg&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;collocation_ni&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;store_full_solution&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1"># Use MA27 linear solver in ipopt for faster calculations:</span>
    <span class="s2">&quot;nlpsol_opts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ipopt.linear_solver&quot;</span><span class="p">:</span> <span class="s2">&quot;mumps&quot;</span><span class="p">},</span>
<span class="p">}</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="o">**</span><span class="n">mpc_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">env</span> <span class="o">=</span> <span class="n">create_inverted_pendulum_environment</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">mpc_params</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s2">&quot;n_horizon&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;n_robust&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="s2">&quot;nlpsol_opts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ipopt.linear_solver&quot;</span><span class="p">:</span> <span class="s2">&quot;mumps&quot;</span><span class="p">},</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">mpc</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="o">**</span><span class="n">mpc_params</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;create_inverted_pendulum_environment&#39; is not defined
</pre></div>
</div>
</div>
</div>
<section id="objective">
<h4>Objective<a class="headerlink" href="#objective" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">create_inverted_pendulum_environment</span><span class="p">()</span>
<span class="n">xss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">distance_cost</span> <span class="o">=</span> <span class="n">casadi</span><span class="o">.</span><span class="n">bilin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">cat</span> <span class="o">-</span> <span class="n">xss</span><span class="p">)</span>
<span class="n">terminal_cost</span> <span class="o">=</span> <span class="n">distance_cost</span>
<span class="n">stage_cost</span> <span class="o">=</span> <span class="n">distance_cost</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage_cost</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">terminal_cost</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">mterm</span><span class="o">=</span><span class="n">terminal_cost</span><span class="p">,</span> <span class="n">lterm</span><span class="o">=</span><span class="n">stage_cost</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">env</span> <span class="o">=</span> <span class="n">create_inverted_pendulum_environment</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">xss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">distance_cost</span> <span class="o">=</span> <span class="n">casadi</span><span class="o">.</span><span class="n">bilin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">cat</span> <span class="o">-</span> <span class="n">xss</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;create_inverted_pendulum_environment&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">force_penalty</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">set_rterm</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="n">force_penalty</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">force_penalty</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">mpc</span><span class="o">.</span><span class="n">set_rterm</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="n">force_penalty</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;mpc&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="constraints">
<h4>Constraints<a class="headerlink" href="#constraints" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lower and upper bounds of the position</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_max</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_max</span>
<span class="c1"># lower and upper bounds of the input</span>
<span class="n">u_max</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;_u&quot;</span><span class="p">,</span> <span class="s2">&quot;force&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">u_max</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;_u&quot;</span><span class="p">,</span> <span class="s2">&quot;force&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_max</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># lower and upper bounds of the position</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">x_max</span> <span class="o">=</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">mpc</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_max</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">mpc</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_max</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># lower and upper bounds of the input</span>

<span class="ne">NameError</span>: name &#39;mpc&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameter-uncertainty">
<h4>Parameter Uncertainty<a class="headerlink" href="#parameter-uncertainty" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_values</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">])</span>
<span class="n">M_values</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">])</span>
<span class="n">mpc</span><span class="o">.</span><span class="n">set_uncertainty_values</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m_values</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">M_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">m_values</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">M_values</span> <span class="o">=</span> <span class="n">ip_parameters</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">mpc</span><span class="o">.</span><span class="n">set_uncertainty_values</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m_values</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">M_values</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;ip_parameters&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h4>Setup<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpc</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mpc</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;mpc&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="simulation">
<h3>Simulation<a class="headerlink" href="#simulation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MPCController</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpc</span><span class="p">:</span> <span class="n">do_mpc</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">MPC</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpc</span> <span class="o">=</span> <span class="n">mpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpc</span><span class="o">.</span><span class="n">reset_history</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpc</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpc</span><span class="o">.</span><span class="n">set_initial_guess</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mpc</span><span class="o">.</span><span class="n">make_step</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="n">max_steps</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">create_inverted_pendulum_environment</span><span class="p">(</span>
    <span class="n">render_mode</span><span class="o">=</span><span class="n">render_mode</span><span class="p">,</span>
    <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
    <span class="n">cutoff_angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
    <span class="n">initial_angle</span><span class="o">=</span><span class="mf">0.99</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span><span class="n">mpc</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">simulate_environment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">max_steps</span> <span class="o">=</span> <span class="mi">100</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">env</span> <span class="o">=</span> <span class="n">create_inverted_pendulum_environment</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">render_mode</span><span class="o">=</span><span class="n">render_mode</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">cutoff_angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">initial_angle</span><span class="o">=</span><span class="mf">0.99</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span><span class="n">mpc</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">results</span> <span class="o">=</span> <span class="n">simulate_environment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;create_inverted_pendulum_environment&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_video</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">env</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">show_video</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">env</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;show_video&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">animate_full_inverted_pendulum_simulation</span><span class="p">(</span><span class="n">mpc</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">animate_full_inverted_pendulum_simulation</span><span class="p">(</span><span class="n">mpc</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;animate_full_inverted_pendulum_simulation&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="learning-based-model-predictive-control">
<h1>Learning-Based Model Predictive Control<a class="headerlink" href="#learning-based-model-predictive-control" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Learning-based MPC addresses the automated and data-driven generation or adaptation of elements of the MPC formulation to improve control performance.</p></li>
<li><p>The learning setup can be diverse:</p>
<ul>
<li><p>Offline learning involves adapting the controller between trials or episodes while collecting data.</p></li>
<li><p>Online learning adjusts the controller during closed-loop operation (e.g. repetitive tasks) or using data from one task execution.</p></li>
</ul>
</li>
<li><p>Much research has focused on automatically improving model quality, as this clearly affects MPC performance.</p></li>
<li><p>Some efforts address the MPC problem formulation directly.</p></li>
<li><p>Others use MPC concepts to satisfy constraints during learning-based control.</p></li>
</ul>
<section id="learning-the-system-dynamics">
<h2>Learning the system dynamics<a class="headerlink" href="#learning-the-system-dynamics" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>MPC relies on accurate system models, so one approach is learning to adjust the model either during operation or between different operational instances.</p></li>
<li><p>Traditionally models are derived offline before control using first principles and identification.</p></li>
<li><p>Robust approaches often consider model uncertainty as well as process noise to lie in compact sets <span class="math notranslate nohighlight">\(\theta_t \in T, w_k \in W\)</span>.</p></li>
<li><p>Stochastic MPC make use of distributional information on the uncertainties.</p></li>
<li><p>Learning-based MPC constructs and updates models and uncertainties from data.</p></li>
</ul>
<ul>
<li><p>Many learning-based MPC techniques make use of an explicit distinction between a nominal
system model <span class="math notranslate nohighlight">\(f_n\)</span> and an additive learned term <span class="math notranslate nohighlight">\(f_l\)</span> accommodating uncertainty:</p>
<div class="math notranslate nohighlight">
\[
  f(x, u, k, w, \theta) = f_n(x, u, k) + f_l(x, u, k, w, \theta)
  \]</div>
</li>
<li><p>Successful learning methods are often based on probabilistic formulations, leading to a
nonlinear stochastic prediction model.</p></li>
<li><p>Leveraging the full potential of such models within MPC, however, is very challenging and remains an active<br />
research field. Many model-learning MPC schemes have therefore evolved from the extensively studied field of robust MPC, offering a large body of available theoretical results.</p></li>
</ul>
<ul class="simple">
<li><p>Robust MPC allows some adaptation but only considers fixed, known model uncertainty.</p></li>
<li><p>Learning-based MPC aims to estimate model uncertainty directly from data.</p></li>
<li><p>This allows adjusting the uncertainty over time to reduce conservatism.</p></li>
<li><p>Many techniques use set-membership identification with bounded noise.</p></li>
<li><p>Parametric approaches find the set of parameter values <span class="math notranslate nohighlight">\(\theta\)</span> consistent with observations.</p></li>
<li><p>Non-parametric approaches form estimates of <span class="math notranslate nohighlight">\(f\)</span> directly from data points.</p></li>
<li><p>The goal is to learn the model uncertainty from measurements, not assume it.</p></li>
</ul>
<section id="stochastic-non-parametric-approaches">
<h3>Stochastic non-parametric approaches<a class="headerlink" href="#stochastic-non-parametric-approaches" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Gaussian process (GP) regression is commonly used in learning-based control due to its flexible non-parametric stochastic approach.</p></li>
<li><p>GP regression assumes dynamics with additive Gaussian noise and models function values as jointly Gaussian based on a kernel function.</p></li>
<li><p>Using recorded state/input data, GP regression provides posterior mean and variance functions as the estimator.</p></li>
<li><p>The variance indicates residual model uncertainty from insufficient data.</p></li>
<li><p>Prediction involves propagating the stochastic state distributions, often approximated as Gaussian.</p></li>
</ul>
<ul class="simple">
<li><p>The learned part of the model can address discrepancies with a nominal model.</p></li>
<li><p>Uncertainty estimates enable heuristic constraint tightening for safety.</p></li>
<li><p>Computation time is a challenge, addressed via data selection, approximations, and simplifying variance.</p></li>
<li><p>GP-based MPC has been applied successfully to various robotic and process control tasks.</p></li>
<li><p>It is a highly data-efficient model-based reinforcement learning technique.</p></li>
</ul>
<center>
    <img src="_static/images/40_gaussian_process.svg" width="80%"/>
</center><figure style="float: left; width: 70%; margin-right: 10%;">
    <img src="_static/images/40_learning_based_mpc_gp.png" width="100%"/>
</figure>
<p>Gaussian process–based MPC for autonomous racing. (b,c) The resulting trajectories of a similar approach applied to miniature radio-controlled cars, with the initial nominal controller shown in panel b and the improved trajectories after learning shown in panel c.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%html</span>
<span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;800&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;480&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://www.youtube.com/embed/-cdXw1MyTUA?si=S3DXY90f8QEPFddI&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;YouTube video player&quot;</span> <span class="na">frameborder</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="na">allow</span><span class="o">=</span><span class="s">&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot;</span> <span class="na">allowfullscreen</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><iframe width="800" height="480" src="https://www.youtube.com/embed/-cdXw1MyTUA?si=S3DXY90f8QEPFddI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div></div>
</div>
</section>
</section>
<section id="learning-the-controller-design">
<h2>Learning the controller design<a class="headerlink" href="#learning-the-controller-design" title="Permalink to this heading">#</a></h2>
<ul>
<li><p>Beyond the model, the MPC cost function and constraints strongly influence closed-loop performance.</p></li>
<li><p>Learning approaches can design the MPC problem to achieve desired controller behavior.</p></li>
<li><p>A parameterized MPC formulation is considered with cost <span class="math notranslate nohighlight">\(g(x,u,\theta_l)\)</span> and constraints <span class="math notranslate nohighlight">\(\mathcal{X}(\theta_\mathcal{X}), \mathcal{U}(\theta_\mathcal{U})\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \begin{array}\\
  U^∗ &amp;= \displaystyle\arg\min_{U} \sum\limits_{i=0}^{T} g(x_i,u_i,\theta_l)\\
  \text{subject to} &amp; x_{i+1} = f(x_i, u_i, \theta_f)\\
  &amp; U = [u_0 , \dots, u_N ] \in \mathcal{U}(\theta_\mathcal{U})\\
  &amp; X = [x_0 , \dots, x_N ] \in \mathcal{X}(\theta_\mathcal{X})\\
  &amp; x_0 = x_k\\
  \end{array}
  \end{split}\]</div>
</li>
<li><p>Both the cost and constraints are parameterized and learned based on observed data.</p></li>
</ul>
<section id="performance-driven-controller-learning">
<h3>Performance-Driven Controller Learning<a class="headerlink" href="#performance-driven-controller-learning" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>MPC can be a rough approximation of the true stochastic optimal control problem.</p></li>
<li><p>Performance-driven learning finds MPC parameters to optimize closed-loop performance.</p></li>
<li><p>It uses Bayesian optimization to optimize the true closed-loop cost <span class="math notranslate nohighlight">\(J(\theta)\)</span> as a function of parameters <span class="math notranslate nohighlight">\(\theta\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(J(\theta)\)</span> is modeled as a Gaussian process to enable optimization.</p></li>
</ul>
<ul class="simple">
<li><p>The finite prediction horizon is a limitation, mitigated via terminal cost and constraint.</p></li>
<li><p>Learning constructs/improves these from data to approximate infinite-horizon cost.</p></li>
<li><p>For nominal systems, trajectories ending in <span class="math notranslate nohighlight">\(X_f\)</span> yield an enlarged invariant set.</p></li>
<li><p>Data is used to iteratively grow <span class="math notranslate nohighlight">\(X_f\)</span> and improve the terminal cost and constraint.</p></li>
</ul>
</section>
<section id="learning-from-demonstration-with-inverse-optimal-control">
<h3>Learning from Demonstration with Inverse Optimal Control<a class="headerlink" href="#learning-from-demonstration-with-inverse-optimal-control" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Designing a cost function or defining an objective mathematically in order to achieve a desired
complex behavior can be tedious and require extensive parameter tuning and development time</p></li>
<li><p>Inverse optimal control addresses this problem by inferring the cost and constraints from demonstrations.</p></li>
<li><p>The hypothesis underlying inverse optimal control is that the observed demonstrations
are the solution of a corresponding optimal control problem.</p></li>
<li><p>Most of the research in inverse optimal control has assumed knowledge of potential constraints
and focused on the cost function instead, following three main steps:</p>
<ol class="arabic simple">
<li><p>Define the optimal control problem with a parametric cost function <span class="math notranslate nohighlight">\(l(x, u, \theta_l)\)</span>,
e.g., quadratic costs with unknown weights <span class="math notranslate nohighlight">\(l(x, u, \theta_l) = x^T Q(\theta_l)x + u^T R(\theta_l)u\)</span>.</p></li>
<li><p>Derive optimality conditions for the parametric optimal control problem.</p></li>
<li><p>Solve optimality conditions for the parameters <span class="math notranslate nohighlight">\(\theta_l\)</span> given the demonstration.</p></li>
</ol>
</li>
</ul>
<ul class="simple">
<li><p>A related field of research is inverse reinforcement learning.</p></li>
<li><p>This technique similarly addresses the problem of identifying a cost or reward function,
typically in the context of probabilistic decision-making, which is often expressed
in terms of Markov decision processes.</p></li>
<li><p>The unknown parameters are obtained by maximizing likelihood.</p></li>
<li><p>These frameworks are typically for discrete state and action spaces.</p></li>
<li><p>They do not explicitly consider system constraints.</p></li>
</ul>
<center>
    <img src="_static/images/40_inverse_optimal_control.png" width="80%"/>
    Concept of learning with inverse optimal control, where the cost function plays the
central role of encoding the demonstrated behavior.
</center></section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="safe-learning-in-robotics">
<h1>Safe Learning in Robotics<a class="headerlink" href="#safe-learning-in-robotics" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Robot learning aims to enable autonomous operation in complex, uncertain environments.</p></li>
<li><p>Challenges include partial knowledge of dynamics, sensors, and other agents.</p></li>
<li><p>Safety guarantees are crucial but difficult with partial knowledge.</p></li>
<li><p>Control theory uses models to provide guarantees.</p></li>
<li><p>Reinforcement learning is data-driven for adaptability but lacks guarantees.</p></li>
<li><p>Combining model- and data-driven approaches leverages their complementary strengths.</p></li>
</ul>
<ul class="simple">
<li><p>Key directions are:</p>
<ul>
<li><p>Robustness against worst-case scenarios.</p></li>
<li><p>Adaptation by learning from observations.</p></li>
<li><p>Leveraging models from domain knowledge and data.</p></li>
</ul>
</li>
<li><p>Control provides the basis for safety-critical applications.</p></li>
<li><p>Safe RL research has grown rapidly.</p></li>
<li><p>Simulation enables RL progress but transferring to real robots remains challenging.</p></li>
</ul>
<center>
<figure>
    <img src="_static/images/40_comparison_model_driven_data_driven.svg" width="90%"/>
    <figcaption>
        A comparison of model-driven, data-driven, and combined approaches.
    </figcaption>
</figure>
</center><ul class="simple">
<li><p>The safe learning control problem is formulated as an optimization with 3 main components:</p>
<ol class="arabic simple">
<li><p>System model describing robot dynamics.</p></li>
<li><p>Cost function defining the control objective.</p></li>
<li><p>Constraints specifying safety requirements.</p></li>
</ol>
</li>
<li><p>The goal is to find a policy fulfilling the task under the safety constraints.</p></li>
<li><p>Any of the 3 components could be initially unknown or partially known.</p></li>
</ul>
<center>
<figure>
    <img src="_static/images/40_safe_control_block_diagram.svg" width="80%"/>
    <figcaption>
        Block diagram representing safe learning control approaches.
    </figcaption>
</figure>
</center><section id="safety-constraints">
<h2>Safety Constraints<a class="headerlink" href="#safety-constraints" title="Permalink to this heading">#</a></h2>
<center>
<figure>
    <img src="_static/images/40_safety_levels.svg" width="100%"/>
    <figcaption>
        Illustration of Safety Levels.
    </figcaption>
</figure>
</center><section id="safety-level-iii-constraint-satisfaction-guaranteed">
<h3>Safety level III: constraint satisfaction guaranteed.<a class="headerlink" href="#safety-level-iii-constraint-satisfaction-guaranteed" title="Permalink to this heading">#</a></h3>
<p>The system satisfies hard constraints:</p>
<div class="math notranslate nohighlight">
\[
c_k^j(x_k, u_k, w_k) \le 0
\]</div>
<p>for all times <span class="math notranslate nohighlight">\(k \in \{0, \dots , N\}\)</span> and constraint indexes <span class="math notranslate nohighlight">\(j \in \{1, \dots, n_c\}\)</span>.</p>
</section>
<section id="safety-level-ii-constraint-satisfaction-with-high-probability">
<h3>Safety level II: constraint satisfaction with high probability.<a class="headerlink" href="#safety-level-ii-constraint-satisfaction-with-high-probability" title="Permalink to this heading">#</a></h3>
<p>The system satisfies probabilistic constraints:</p>
<div class="math notranslate nohighlight">
\[
P\left[c_k^j(x_k, u_k, w_k ) \le 0 \right] \ge p^j,
\]</div>
<p>where <span class="math notranslate nohighlight">\(P[\cdot]\)</span> denotes the probability and <span class="math notranslate nohighlight">\(p^j \in (0, 1)\)</span> defines the likelihood of the jth constraint
being satisfied, for all times <span class="math notranslate nohighlight">\(k \in \{0, \dots , N\}\)</span> and constraint indexes <span class="math notranslate nohighlight">\(j \in \{1, \dots, n_c\}\)</span>.</p>
</section>
<section id="safety-level-i-constraint-satisfaction-encouraged">
<h3>Safety level I: constraint satisfaction encouraged<a class="headerlink" href="#safety-level-i-constraint-satisfaction-encouraged" title="Permalink to this heading">#</a></h3>
<p>The system encourages constraint satisfaction. This can be achieved in different ways:</p>
<ul>
<li><p>One way is to add a penalty term to the objective function that discourages
the violation of constraints with a high cost. A non-negative <span class="math notranslate nohighlight">\(\epsilon_j\)</span> is added
to the right-hand side of the inequality in Safety level III, for all times <span class="math notranslate nohighlight">\(k \in \{0, \dots , N\}\)</span>
and constraint indexes <span class="math notranslate nohighlight">\(j \in \{1, \dots, n_c\}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  c_k^j(x_k, u_k, w_k) \le \epsilon_j,
  \]</div>
<p>and an appropriate penalty term l () ≥ 0, with l () = 0 ⇐⇒  = 0, is added to the objective
function. The vector  includes all elements ϵj and is an additional variable of the optimization problem.</p>
</li>
</ul>
<ul>
<li><p>Another way is to provide guarantees on the expected value of the constraint but only at a trajectory level:</p>
<div class="math notranslate nohighlight">
\[
  J_{c^j} = E\left[ \sum\limits_{k=0}^{N-1} c_k^j(x_k, u_k, w_k) \right] \le d_j,
  \]</div>
<p>where <span class="math notranslate nohighlight">\(J_{c^j}\)</span> represents the expected total constraint cost, and <span class="math notranslate nohighlight">\(d_j\)</span> defines the constraint threshold.</p>
</li>
</ul>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="safe-learning-control-approaches">
<h1>Safe Learning Control Approaches<a class="headerlink" href="#safe-learning-control-approaches" title="Permalink to this heading">#</a></h1>
<section id="learning-uncertain-dynamics-to-safely-improve-performance">
<h2>Learning uncertain dynamics to safely improve performance<a class="headerlink" href="#learning-uncertain-dynamics-to-safely-improve-performance" title="Permalink to this heading">#</a></h2>
<p>These works rely on an apriori model of the robot dynamics. The robot’s performance is improved by learning the uncertain dynamics from data. Safety is typically guaranteed based on standard control-theoretic
frameworks, achieving safety level II or III.</p>
</section>
<section id="encouraging-safety-and-robustness-in-rl">
<h2>Encouraging safety and robustness in RL<a class="headerlink" href="#encouraging-safety-and-robustness-in-rl" title="Permalink to this heading">#</a></h2>
<p>These works encompass approaches that usually do not have knowledge of an apriori robot model or the safety constraints. Rather than providing hard safety guarantees, these approaches encourage safe robot operation (safety
level I), for example, by penalizing dangerous actions.</p>
</section>
<section id="certifying-learning-based-control-under-dynamics-uncertainty">
<h2>Certifying learning-based control under dynamics uncertainty<a class="headerlink" href="#certifying-learning-based-control-under-dynamics-uncertainty" title="Permalink to this heading">#</a></h2>
<p>These works aim to provide safety certificates for learning-based controllers that do not inherently consider safety
constraints. These approaches modify the learning controller output by constraining the control policy, leveraging a known safe backup controller, or modifying the controller output directly to achieve stability and/or constraint satisfaction. They typically achieve safety level II or III.</p>
<section id="model-predictive-safety-filter">
<h3>Model Predictive Safety Filter<a class="headerlink" href="#model-predictive-safety-filter" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>General learning-based control, particularly Reinforcement Learning,
has shown great success in solving complex and high-dimensional control tasks.</p></li>
<li><p>However most techniques cannot ensure that safety constraints
under physical limitations are met, particularly during learning iterations.</p></li>
<li><p>To address this limitation, safety frameworks emerged from control theory.</p></li>
<li><p>MPC techniques can be used for such safety filters to turn a safety-critical dynamical system
into an inherently safe system to which any learning-based controller
without safety certificates can be applied out of the box.</p></li>
</ul>
<div>
<figure style="float: left; width: 70%;">
    <img src="_static/images/40_safety_filter.svg" width="100%"/>
</figure>
<div style="float: right; width: 25%;">
<br><br><br>Based on the current state $x$, a learning-based controller provides an input
$u_L = \pi_L(x) \in \mathbb{R}^m$, which is processed by the safety filter $u = \pi_S(x, u_S)$ and applied to the real system.
</div>
</div><ul class="simple">
<li><p>The idea is to address the solution to the stochastic optimal control problem
through learning-based control methods.</p></li>
<li><p>The proposed learning-based control input <span class="math notranslate nohighlight">\(u_L(k)\)</span> at time <span class="math notranslate nohighlight">\(k\)</span> is
then verified in terms of safety by computing a safe backup trajectory from the one-step predicted
state <span class="math notranslate nohighlight">\(x_{1|k}\)</span> to a safe terminal set <span class="math notranslate nohighlight">\(X_f\)</span> or by modifying <span class="math notranslate nohighlight">\(u_L(k)\)</span> as little as possible
while still providing a safe backup trajectory.</p></li>
<li><p>The optimization problem necessary for validating safety of the input
is computationally cheaper than a direct optimization of the task
and can often be carried out over a reasonably short horizon.</p></li>
</ul>
<p>The model predictive safety filter <span class="math notranslate nohighlight">\(\pi_S\)</span> is realized through an MPC-like optimization problem of the form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}\\
\displaystyle\min_{U} &amp; || u_{0|k} - u_L(k)||\\
\text{subject to} &amp; x_{i+1|k} = f(x_{i|k}, u_{i|k}, i + k)\\
&amp; U = [u_{0|k}, \dots, u_{N|k}] \in U_j, \forall j = 1, \dots, n_{cu}\\
&amp; X = [x_{0|k}, \dots, x_{N|k}] \in X_j, \forall j = 1, \dots, n_{cx}\\
&amp; x_{N|k} \in X_f \\
&amp; x_{0|k} = x_k
\end{array}
\end{split}\]</div>
<div>
<figure style="float: left; width: 70%;">
    <img src="_static/images/40_safe_learning_approaches.svg" width="100%"/>
</figure>
<div style="float: left; width: 20%;">
<br><br><br>Summary of safe learning control approaches.
</div>
</div></section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="#rosolia_datadriven_2018-back"><span class="xref myst"><b id="rosolia_datadriven_2018">[Rosolia, U., Zhang, X. and Borrelli, F., 2018]</b></span></a> Rosolia, Ugo, Xiaojing Zhang, and Francesco Borrelli. <a class="reference external" href="https://www.annualreviews.org/doi/full/10.1146/annurev-control-060117-105215">Data-driven predictive control for autonomous systems.</a> Annual Review of Control, Robotics, and Autonomous Systems 1 (2018): 259-286.</p></li>
<li><p><a class="reference internal" href="#hewing_learningbased_2020-back"><span class="xref myst"><b id="hewing_learningbased_2020">[Hewing, Lukas, et al. 2020]</b></span></a> Hewing, Lukas, Kim P. Wabersich, Marcel Menner, and Melanie N. Zeilinger. <a class="reference external" href="https://www.annualreviews.org/doi/full/10.1146/annurev-control-090419-075625">Learning-based model predictive control: Toward safe learning in control.</a> Annual Review of Control, Robotics, and Autonomous Systems 3 (2020): 269-296.</p></li>
<li><p><a class="reference internal" href="#brunke_safe_2022-back"><span class="xref myst"><b id="brunke_safe_2022">[Brunke, Lukas, et al. 2022]</b></span></a> Brunke, Lukas, Melissa Greeff, Adam W. Hall, Zhaocong Yuan, Siqi Zhou, Jacopo Panerati, and Angela P. Schoellig. <a class="reference external" href="https://www.annualreviews.org/doi/abs/10.1146/annurev-control-042920-020211">Safe learning in robotics: From learning-based control to safe reinforcement learning.</a> Annual Review of Control, Robotics, and Autonomous Systems 5 (2022): 411-444.</p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "aai-institute/tfl-training-machine-learning-control",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="nb_20_ControlAndPlanning.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="../apidocs/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stochastic-optimal-control-problem">Stochastic Optimal Control Problem</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stochastic-predictive-control">Stochastic Predictive Control</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-design-challenges">Control Design Challenges</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#robust-mpc">Robust MPC</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-stage-mpc">Multi-Stage MPC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-inverted-pendulum">Example - Inverted Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model">Model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-states-and-control-inputs">Model, States and Control inputs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ode">ODE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controller">Controller</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#objective">Objective</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#constraints">Constraints</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-uncertainty">Parameter Uncertainty</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Setup</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-based-model-predictive-control">Learning-Based Model Predictive Control</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-the-system-dynamics">Learning the system dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stochastic-non-parametric-approaches">Stochastic non-parametric approaches</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-the-controller-design">Learning the controller design</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-driven-controller-learning">Performance-Driven Controller Learning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-from-demonstration-with-inverse-optimal-control">Learning from Demonstration with Inverse Optimal Control</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#safe-learning-in-robotics">Safe Learning in Robotics</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-constraints">Safety Constraints</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-level-iii-constraint-satisfaction-guaranteed">Safety level III: constraint satisfaction guaranteed.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-level-ii-constraint-satisfaction-with-high-probability">Safety level II: constraint satisfaction with high probability.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-level-i-constraint-satisfaction-encouraged">Safety level I: constraint satisfaction encouraged</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#safe-learning-control-approaches">Safe Learning Control Approaches</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-uncertain-dynamics-to-safely-improve-performance">Learning uncertain dynamics to safely improve performance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encouraging-safety-and-robustness-in-rl">Encouraging safety and robustness in RL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certifying-learning-based-control-under-dynamics-uncertainty">Certifying learning-based control under dynamics uncertainty</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-predictive-safety-filter">Model Predictive Safety Filter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By appliedAI TransferLab
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>