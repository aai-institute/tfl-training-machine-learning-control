
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Machine Learning &amp; Control &#8212; Machine Learning Control Training</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"loader": {"load": ["[tex]/configmacros"]}, "tex": {"packages": {"[+]": ["configmacros"]}, "macros": {"vect": ["{\\mathbf{\\boldsymbol{#1}} }", 1], "E": "{\\mathbb{E}}", "P": "{\\mathbb{P}}", "R": "{\\mathbb{R}}", "abs": ["{\\left| #1 \\right|}", 1], "simpl": ["{\\Delta^{#1} }", 1], "amax": "{\\text{argmax}}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/nb_70_machine_learning_control';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Safe Learning in Robotics" href="nb_80_safe_learning_control.html" />
    <link rel="prev" title="MPC and AlphaZero" href="nb_60_MCTS.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/transferlab-logo.svg" class="logo__image only-light" alt="Machine Learning Control Training - Home"/>
    <script>document.write(`<img src="../_static/transferlab-logo-dark.svg" class="logo__image only-dark" alt="Machine Learning Control Training - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebook Pages</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="nb_10_introduction.html">Introduction</a></li>



<li class="toctree-l1"><a class="reference internal" href="nb_20_dynamic_programming.html">Dynamic Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="nb_30_systems.html">Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="nb_40_LQR.html">Linear Quadratic Regulator</a></li>



<li class="toctree-l1"><a class="reference internal" href="nb_50_MPC.html">Model Predictive Control</a></li>

<li class="toctree-l1"><a class="reference internal" href="nb_60_MCTS.html">MPC and AlphaZero</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Machine Learning &amp; Control</a></li>



<li class="toctree-l1"><a class="reference internal" href="nb_80_safe_learning_control.html">Safe Learning in Robotics</a></li>

<li class="toctree-l1"><a class="reference internal" href="nb_90_practice.html">Practice</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Code</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../apidocs/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.environments.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.environments</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.environments.grid_world.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.environments.grid_world</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.environments.utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.environments.utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.environments.cart.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.environments.cart</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.environments.inverted_pendulum.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.environments.inverted_pendulum</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.models.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.models</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.models.models.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.models.models</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.models.sindy.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.models.sindy</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.models.dmd.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.models.dmd</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.nb_utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.nb_utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.shortest_path_problem.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.shortest_path_problem</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.plots.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.plots</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.hyperopt.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.hyperopt</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../apidocs/training_ml_control/training_ml_control.control.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">training_ml_control.control</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/nb_70_machine_learning_control.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Machine Learning & Control</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Machine Learning &amp; Control</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-based-control">Learning-Based Control</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#system-identification">System Identification</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-collection">Data Collection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cart">Cart</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-fitting">Model Fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-deep-learning">Naive Deep Learning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deep-learning-with-nominal-model">Deep Learning with Nominal Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sparse-identification-of-nonlinear-dynamics-sindy">Sparse Identification of Nonlinear Dynamics (SINDy)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sindy-with-control-sindyc">SINDy with Control (SINDyc)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#koopman-operator">Koopman Operator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-mode-decomposition-dmd">Dynamic Mode Decomposition (DMD)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#variants">Variants</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dmd-with-control-dmdc">DMD with Control (DMDc)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison">Comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-to-systems">Application to Systems</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Cart</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sindyc">SINDYc</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dmdc">DMDc</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inverted-pendulum">Inverted Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="machine-learning-control">
<h1>Machine Learning &amp; Control<a class="headerlink" href="#machine-learning-control" title="Link to this heading">#</a></h1>
<p>Modern machine learning provides useful tools and perspectives for control theory. Framing control problems as data modeling tasks enables powerful function approximation, estimation, and optimization techniques from machine learning to be applied.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="learning-based-control">
<h1>Learning-Based Control<a class="headerlink" href="#learning-based-control" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Learning-based control addresses the automated and data-driven generation or adaptation of elements of the controller formulation to improve control performance.</p></li>
<li><p>The learning setup can be diverse:</p>
<ul>
<li><p>Offline learning involves adapting the controller between trials or episodes while collecting data.</p></li>
<li><p>Online learning adjusts the controller during closed-loop operation (e.g. repetitive tasks) or using data from one task execution.</p></li>
</ul>
</li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="system-identification">
<h1>System Identification<a class="headerlink" href="#system-identification" title="Link to this heading">#</a></h1>
<p>System Identification is the process of constructing a model of a (dynamical) system from observations (measurements) of its inputs and outputs. System identification also includes the optimal design of experiments for efficiently generating informative data for fitting such models as well as model reduction.</p>
<p>In control engineering, the objective is to obtain a good performance of the closed-loop system, which is the one comprising the physical system, the feedback loop and the controller. This performance is typically achieved by designing the control law relying on a model of the system, which needs to be identified starting from experimental data. If the model identification procedure is aimed at control purposes, what really matters is not to obtain the best possible model that fits the data, as in the classical system identification approach, but to obtain a model satisfying enough for the closed-loop performance.</p>
<p>In control engineering, we typically rely on the mathematical modelling of the system from first principles and then optionally use parameter identification methods to determine the values of the mathematical model’s parameters.</p>
<p>In our case, we will not rely on that and instead prefer fitting a model based only on measured data.</p>
<div class="exercise admonition" id="model-evaluation">

<p class="admonition-title"><span class="caption-number">Exercise 6 </span> (Dynamic System Model Evaluation)</p>
<section id="exercise-content">
<p>How do we evaluation the fitted model of the system?</p>
</section>
</div>
<div class="solution dropdown admonition" id="notebooks/nb_70_machine_learning_control-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#model-evaluation">  ( 6</a></p>
<section id="solution-content">
<ul class="simple">
<li><p>We could evaluate the model’s prediction on a held-out validation set.</p></li>
<li><p>Additionally we could evaluate the model’s long-term predictions in an open-loop manner.</p></li>
<li><p>On top of that, we could evaluate the model’s step<a class="footnote-reference brackets" href="#id14" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> and impulse<a class="footnote-reference brackets" href="#id15" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> responses from different initial states. This is especially useful for linear systems.</p></li>
<li><p>It is also valuable to look at what the model’s residuals and make sure there is no correlation with other available information such as the input.</p></li>
</ul>
</section>
</div>
<section id="data-collection">
<h2>Data Collection<a class="headerlink" href="#data-collection" title="Link to this heading">#</a></h2>
<p>Before learning a model of the system, we need to collect either during the system’s operation i.e. online data collection, or inbetween episodes of the system’s operation i.e. offline data collection. The collected data has to be informative, i.e. comprehensive and be representative of the all behaviours of the system that we desire to capture.</p>
<p>Data informativity is a condition on the data under which it is possible to distinguish between different models in a (parametric) model class.</p>
<p>Commonly used input signals for system identification:</p>
<ul>
<li><p>Step function</p></li>
<li><p>Pseudorandom binary sequence (PRBS)</p></li>
<li><p>Autoregressive, moving average process</p></li>
<li><p>Periodic signals: sum of sinusoids</p></li>
<li><p>Schroeder Sweep (Sum of phase shifted sinusoids)</p>
<div class="math notranslate nohighlight">
\[
  u(t) = \sum\limits_{k=1}^M A_k \cos(\frac{2\pi k \tau(t)}{T} + \phi_k), \quad t = 0, 1, \dots , N − 1
  \]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \begin{array}{l}
  k = \sqrt{\frac{P}{M}}\\
  \phi_1 = 0\\
  \phi_k = \phi_{k-1} − \frac{\pi k^2}{N}, \quad k = 2, 3, \dots , M
  \end{array}
  \end{split}\]</div>
<p>With <span class="math notranslate nohighlight">\(M\)</span> the number of harmonically related frequencies, <span class="math notranslate nohighlight">\(\phi_k\)</span> the phase angles of the harmonic components to produce low Peak Factor (PF),
<span class="math notranslate nohighlight">\(N\)</span> the number of time steps, <span class="math notranslate nohighlight">\(P\)</span> the total desired input power.</p>
</li>
</ul>
<p>For certain systems in many safety-critical tasks such as space exploration or robot-assisted surgery we have to rely on human experts to control the system and avoid damaging it or its environment.</p>
<section id="cart">
<h3>Cart<a class="headerlink" href="#cart" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cart_env</span> <span class="o">=</span> <span class="n">create_cart_environment</span><span class="p">(</span><span class="n">max_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">goal_position</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_position</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cart_observations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cart_actions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cart_frames</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">controllers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Step&quot;</span><span class="p">:</span> <span class="n">ConstantController</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">cart_env</span><span class="o">.</span><span class="n">max_action</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])),</span>
    <span class="s2">&quot;Sinusoid @ 10Hz&quot;</span><span class="p">:</span> <span class="n">SineController</span><span class="p">(</span>
        <span class="n">cart_env</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">cart_env</span><span class="o">.</span><span class="n">max_action</span><span class="p">]),</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">),</span>
    <span class="s2">&quot;Sinusoid @ 0.5Hz&quot;</span><span class="p">:</span> <span class="n">SineController</span><span class="p">(</span>
        <span class="n">cart_env</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">cart_env</span><span class="o">.</span><span class="n">max_action</span><span class="p">]),</span> <span class="n">frequency</span><span class="o">=</span><span class="mf">0.5</span>
    <span class="p">),</span>
    <span class="s2">&quot;Schroeder Sweep&quot;</span><span class="p">:</span> <span class="n">SchroederSweepController</span><span class="p">(</span>
        <span class="n">cart_env</span><span class="p">,</span>
        <span class="n">n_time_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">n_harmonics</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;PRBS&quot;</span><span class="p">:</span> <span class="n">PRBSController</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">cart_env</span><span class="o">.</span><span class="n">max_action</span><span class="p">])),</span>
    <span class="s2">&quot;Random&quot;</span><span class="p">:</span> <span class="n">RandomController</span><span class="p">(</span><span class="n">cart_env</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">controller_name</span><span class="p">,</span> <span class="n">controller</span> <span class="ow">in</span> <span class="n">controllers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">simulate_environment</span><span class="p">(</span><span class="n">cart_env</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">)</span>
    <span class="n">cart_observations</span><span class="p">[</span><span class="n">controller_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">observations</span>
    <span class="n">cart_actions</span><span class="p">[</span><span class="n">controller_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">actions</span>
    <span class="n">cart_frames</span><span class="p">[</span><span class="n">controller_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">frames</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>error: XDG_RUNTIME_DIR not set in the environment.
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/5282ce099a43f90b7d36202ecca449defce66e551ee297cdf17ad09b598d3b5e.png" src="../_images/5282ce099a43f90b7d36202ecca449defce66e551ee297cdf17ad09b598d3b5e.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/0ec50286a0a4767097e0e080c6aaeb548cc3506309bb8059e35009527f1adcd4.png" src="../_images/0ec50286a0a4767097e0e080c6aaeb548cc3506309bb8059e35009527f1adcd4.png" />
</div>
</div>
<p>Let’s look at the phase portrait<a class="footnote-reference brackets" href="#id16" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> instead.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/a1722c7521cf8fe6e2e7ab02f831ac24949884aea593c06c6c08a4d6881b39b4.png" src="../_images/a1722c7521cf8fe6e2e7ab02f831ac24949884aea593c06c6c08a4d6881b39b4.png" />
</div>
</div>
<p>Let’s visualize the Power Spectral Density (PSD) of the input and state signals</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/34d8eb7da2554a3b54d1b75ea2f38988a7d72d13b93ea32067eaec9873e8ef19.png" src="../_images/34d8eb7da2554a3b54d1b75ea2f38988a7d72d13b93ea32067eaec9873e8ef19.png" />
</div>
</div>
</section>
</section>
<section id="model-fitting">
<h2>Model Fitting<a class="headerlink" href="#model-fitting" title="Link to this heading">#</a></h2>
<section id="naive-deep-learning">
<h3>Naive Deep Learning<a class="headerlink" href="#naive-deep-learning" title="Link to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[
\mathbf{x}_{t+1} = f_\theta(\mathbf{x}_t, \mathbf{u}_t)
\]</div>
<p>Where <span class="math notranslate nohighlight">\(\theta\)</span> are learnable parameters.</p>
<p>Issues with such an approach:</p>
<ul class="simple">
<li><p>Domain shift from the training distribution to the real-world distribution.</p></li>
<li><p>Black-box.</p></li>
</ul>
</section>
<section id="deep-learning-with-nominal-model">
<h3>Deep Learning with Nominal Model<a class="headerlink" href="#deep-learning-with-nominal-model" title="Link to this heading">#</a></h3>
<p>A real-world dynamical system can be described as:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{x}_{t+1} = \underbrace{f_n(\mathbf{x}_t, \mathbf{u}_t)}_{\text{nominal dynamics}} + \underbrace{g_r(\mathbf{x}_t, \mathbf{u}_t)}_{\text{residual dynamics}} + \underbrace{w_t}_{\text{disturbance}}
\]</div>
<p>Where <span class="math notranslate nohighlight">\(f_n\)</span> is the nominalsystem model, <span class="math notranslate nohighlight">\(g_r\)</span> an additive residual term accommodating uncertainty and <span class="math notranslate nohighlight">\(w_t\)</span> represents distburnances.</p>
<p>Many learning-based techniques make use of this explicit distinction by only learning the residual term.</p>
<p>An example of the use of this approach can be found in <span id="id4">[<a class="reference internal" href="home.html#id33" title="Guanya Shi, Xichen Shi, Michael O'Connell, Rose Yu, Kamyar Azizzadenesheli, Animashree Anandkumar, Yisong Yue, and Soon-Jo Chung. Neural Lander: Stable Drone Landing Control Using Learned Dynamics. In 2019 International Conference on Robotics and Automation (ICRA), 9784–9790. May 2019. doi:10.1109/ICRA.2019.8794351.">SSOConnell+19</a>]</span>.</p>
<p><a class="reference internal" href="#neural-lander-diagram"><span class="std std-ref">Visual depiction of the ground effect, the complex aerodynamic effect between the drone and the ground, which is nonlinear, nonstationary, and very hard to model using standard system identification approaches. Adapted from Neural Control blog post.</span></a> is a figure depicting the ground effect that is modelled using a neural network and
<a class="reference internal" href="#neural-lander-gif"><span class="std std-ref">Comparison of drone landing with and without neural network modelling of residual ground effect. Taken from Neural Control blog post.</span></a> is a comparison of drone landings with and without neural network modeling.</p>
<figure class="align-default" id="neural-lander-diagram">
<a class="reference internal image-reference" href="../_images/60_neural_lander_diagram.png"><img alt="../_images/60_neural_lander_diagram.png" src="../_images/60_neural_lander_diagram.png" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Visual depiction of the ground effect, the complex aerodynamic effect between the drone and the ground, which is nonlinear, nonstationary, and very hard to model using standard system identification approaches. <em>Adapted from <a class="reference external" href="https://www.gshi.me/blog/NeuralControl/">Neural Control blog post</a></em>.</span><a class="headerlink" href="#neural-lander-diagram" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="neural-lander-gif">
<a class="reference internal image-reference" href="../_images/60_neural_lander.gif"><img alt="../_images/60_neural_lander.gif" src="../_images/60_neural_lander.gif" style="width: 60%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Comparison of drone landing with and without neural network modelling of residual ground effect. <em>Taken from <a class="reference external" href="https://www.gshi.me/blog/NeuralControl/">Neural Control blog post</a></em>.</span><a class="headerlink" href="#neural-lander-gif" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Issues with such an approach:</p>
<ul class="simple">
<li><p>Requires nominal model.</p></li>
<li><p>Still susceptible to domain shift issues.</p></li>
</ul>
</section>
<section id="sparse-identification-of-nonlinear-dynamics-sindy">
<h3>Sparse Identification of Nonlinear Dynamics (SINDy)<a class="headerlink" href="#sparse-identification-of-nonlinear-dynamics-sindy" title="Link to this heading">#</a></h3>
<p>The SINDY algorithm identifies fully nonlinear dynamical systems from measurement data. This relies on the fact that many dynamical systems have relatively few terms in the right hand side of the governing equations:</p>
<div class="math notranslate nohighlight">
\[
\dot{\mathbf{x}} = f(\mathbf{x})
\]</div>
<p>To determine the function <span class="math notranslate nohighlight">\(f\)</span> from data, we collect a time history of the state <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and either measure the derivative <span class="math notranslate nohighlight">\(\dot{\mathbf{x}}\)</span>
or approximate it numerically. The data are sampled at several times <span class="math notranslate nohighlight">\(t_1, t_2, \dots, t_m\)</span> and arranged into two matrices:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{X} = \begin{bmatrix}
\mathbf{x}^T(t_1)\\
\mathbf{x}^T(t_2)\\
\vdots\\
\mathbf{x}^T(t_m)
\end{bmatrix}
= \begin{bmatrix}
x_1(t_1) &amp; x_2(t_1) &amp; \dots &amp; x_n(t_1)\\
x_1(t_2) &amp; x_2(t_2) &amp; \dots &amp; x_n(t_2)\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
x_1(t_m) &amp; x_2(t_m) &amp; \dots &amp; x_n(t_m)\\
\end{bmatrix}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\dot{\mathbf{X}} = \begin{bmatrix}
\dot{\mathbf{x}}^T(t_1)\\
\dot{\mathbf{x}}^T(t_2)\\
\vdots\\
\dot{\mathbf{x}}^T(t_m)
\end{bmatrix}
= \begin{bmatrix}
\dot{x}_1(t_1) &amp; \dot{x}_2(t_1) &amp; \dots &amp; \dot{x}_n(t_1)\\
\dot{x}_1(t_2) &amp; \dot{x}_2(t_2) &amp; \dots &amp; \dot{x}_n(t_2)\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
\dot{x}_1(t_m) &amp; \dot{x}_2(t_m) &amp; \dots &amp; \dot{x}_n(t_m)\\
\end{bmatrix}
\end{split}\]</div>
<p>Next, we construct a library <span class="math notranslate nohighlight">\(\Theta(\mathbf{X})\)</span> consisting of candidate non-linear functions of the columns of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>.
For example, \Theta(\mathbf{X})$ may consist of constant, polynomial, and trigonometric terms:</p>
<div class="math notranslate nohighlight">
\[
\Theta(\mathbf{X}) = \begin{bmatrix}
\mathbf{1} &amp; \mathbf{X} &amp; \mathbf{X}^{P_2} &amp; \mathbf{X}^{P_3} &amp; \dots &amp; \sin(\mathbf{X}) &amp; \cos(\mathbf{X}) 
\end{bmatrix}
\]</div>
<p>Here, higher polynomials are denoted as <span class="math notranslate nohighlight">\(\mathbf{X}^{P_2}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{X}^{P_3}\)</span>, etc.,
where <span class="math notranslate nohighlight">\(\mathbf{X}^{P_2}\)</span> denotes the quadratic nonlinearities in the state x:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{X}^{P_2} = \begin{bmatrix}
x_1^2(t_1) &amp; x_1(t_1)x_2(t_1) &amp; \dots &amp; x_n^2(t_1)\\
x_1^2(t_2) &amp; x_1(t_2)x_2(t_2) &amp; \dots &amp; x_n^2(t_2)\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
x_1^2(t_m) &amp; x_1(t_m)x_2(t_m) &amp; \dots &amp; x_n^2(t_m)\\
\end{bmatrix}
\end{split}\]</div>
<p>Each column of <span class="math notranslate nohighlight">\(\Theta(\mathbf{X})\)</span> represents a candidate function for the right-hand side of the system’s ODE.
There is tremendous freedom in choosing the entries in this matrix of nonlinearities.</p>
<p>Because we assume that only a few of these nonlinearities are active in each row of <span class="math notranslate nohighlight">\(f\)</span>,
we may set up a sparse regression problem to determine the sparse vectors of coefficients
<span class="math notranslate nohighlight">\(\Xi = \begin{bmatrix} \xi_1 ^ \xi_2 &amp; \dots &amp; \xi_n \end{bmatrix}\)</span> that determine which nonlinearities are active:</p>
<div class="math notranslate nohighlight">
\[
\dot{\mathbf{X}} = \Theta(\mathbf{X})\Xi
\]</div>
<p>This is illustrated in <a class="reference internal" href="#sindy-diagram"><span class="std std-ref">Schematic of the SINDy algorithm, demonstrated on the Lorenz equations. Data are collected from the system, including a time history of the states \mathbf{X} and derivatives \dot{\mathbf{X}}. Next, a library of nonlinear functions of the states, \Theta(\mathbf{X}), is constructed. This is then used to find the fewest terms needed to satisfy \dot{\mathbf{X}} = \Theta(\mathbf{X})\Xi. The few entries in the vectors of \Xi, solved for by sparse regression, denote the relevant
terms in the right-hand side of the dynamics. Taken from brunton_discovering_2016</span></a>. Each column <span class="math notranslate nohighlight">\(\xi_k\)</span> of <span class="math notranslate nohighlight">\(Xi\)</span> is a sparse vector of coefficients determining
which terms are active in the right-hand side for one of the row equations:</p>
<div class="math notranslate nohighlight">
\[
\dot{x}_k = f_k(x) = \Theta(x^T)\xi_k
\]</div>
<figure class="align-default" id="sindy-diagram">
<a class="reference internal image-reference" href="../_images/70_sindy_diagram.svg"><img alt="../_images/70_sindy_diagram.svg" src="../_images/70_sindy_diagram.svg" width="80%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">Schematic of the SINDy algorithm, demonstrated on the Lorenz equations. Data are collected from the system, including a time history of the states <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> and derivatives <span class="math notranslate nohighlight">\(\dot{\mathbf{X}}\)</span>. Next, a library of nonlinear functions of the states, <span class="math notranslate nohighlight">\(\Theta(\mathbf{X})\)</span>, is constructed. This is then used to find the fewest terms needed to satisfy <span class="math notranslate nohighlight">\(\dot{\mathbf{X}} = \Theta(\mathbf{X})\Xi\)</span>. The few entries in the vectors of <span class="math notranslate nohighlight">\(\Xi\)</span>, solved for by sparse regression, denote the relevant
terms in the right-hand side of the dynamics. <em>Taken from <span id="id5">[<a class="reference internal" href="home.html#id6" title="Steven L. Brunton, Joshua L. Proctor, and J. Nathan Kutz. Discovering governing equations from data by sparse identification of nonlinear dynamical systems. Proceedings of the National Academy of Sciences, 113(15):3932–3937, April 2016. doi:10.1073/pnas.1517384113.">BPK16a</a>]</span></em></span><a class="headerlink" href="#sindy-diagram" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="sindy-with-control-sindyc">
<h4>SINDy with Control (SINDyc)<a class="headerlink" href="#sindy-with-control-sindyc" title="Link to this heading">#</a></h4>
<p>SINDYc generalizes the SINDY method to include inputs and control. In particular, it considers the nonlinear dynamical system with inputs <span class="math notranslate nohighlight">\(\mathbf{u}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\dot{\mathbf{x}} = f(\mathbf{x}, \mathbf{u})
\]</div>
<p>The SINDY algorithm is readily generalized to include actuation, as this merely requires building a larger library <span class="math notranslate nohighlight">\(\Theta(\mathbf{X}, \mathbf{U})\)</span>
of candidate functions that include <span class="math notranslate nohighlight">\(u\)</span>; these functions can include nonlinear cross terms in <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{u}\)</span>.
This extension requires measurements of the state <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> as well as the input signal <span class="math notranslate nohighlight">\(\mathbf{u}\)</span>.</p>
<figure class="align-default" id="id17">
<a class="reference internal image-reference" href="../_images/70_sindy_with_control_diagram.svg"><img alt="../_images/70_sindy_with_control_diagram.svg" src="../_images/70_sindy_with_control_diagram.svg" width="80%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Schematic of the SINDy with control algorithm. Active terms in a library of candidate nonlinearities are selected via sparse regression. <em>Taken from <span id="id6">[<a class="reference internal" href="home.html#id12" title="Urban Fasel, Eurika Kaiser, J. Nathan Kutz, Bingni W. Brunton, and Steven L. Brunton. SINDy with Control: A Tutorial. https://arxiv.org/abs/2108.13404v1, August 2021.">FKK+21</a>]</span></em>.</span><a class="headerlink" href="#id17" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="koopman-operator">
<h3>Koopman Operator<a class="headerlink" href="#koopman-operator" title="Link to this heading">#</a></h3>
<figure class="align-center" id="id18">
<a class="reference internal image-reference" href="../_images/60_koopman_operators_summary.svg"><img alt="Koopman Operators Summary" src="../_images/60_koopman_operators_summary.svg" width="70%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Summary of the idea of Koopman operators. By lifting to a space of observables, we
trade a nonlinear finite-dimensional system for a linear infinite-dimensional system. <em>Taken from <span id="id7">[<a class="reference internal" href="home.html#id10" title="Matthew J. Colbrook. The Multiverse of Dynamic Mode Decomposition Algorithms. November 2023. doi:10.48550/arXiv.2312.00137.">Col23</a>]</span></em>.</span><a class="headerlink" href="#id18" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Given <span class="math notranslate nohighlight">\(\mathcal{F}\)</span> a space of functions <span class="math notranslate nohighlight">\(g: \Omega \rightarrow \mathbb{C}\)</span>, and <span class="math notranslate nohighlight">\(\Omega\)</span> the state space of our dynamical system. The Koopman operator is defined on  a suitable domain <span class="math notranslate nohighlight">\(\mathcal{D}(\mathcal{K}) \subset \mathcal{F}\)</span> via the composition formula:</p>
<div class="math notranslate nohighlight">
\[
[\mathcal{K}g](\mathbf{x}) = [g \circ f](\mathbf{x}) = g(f(\mathbf{x})), \quad g \in \mathcal{D}(\mathcal{K})
\]</div>
<p>Where <span class="math notranslate nohighlight">\(\mathbf{x}_{t+1} = f(\mathbf{x}_t)\)</span></p>
<p>The functions <span class="math notranslate nohighlight">\(g\)</span>, referred to as <em>observables</em>, serve as tools for indirectly measuring the state of the system.
Specifically, <span class="math notranslate nohighlight">\(g(x_t)\)</span> indirectly measures the state <span class="math notranslate nohighlight">\(x_t\)</span>.</p>
<p>In this context, <span class="math notranslate nohighlight">\([\mathcal{K}g](\mathbf{x}_t) = g(f(\mathbf{x}_t)) = g(\mathbf{x}_{t+1})\)</span> represents the measurement of the state one time
step ahead of <span class="math notranslate nohighlight">\(g(\mathbf{x}_t)\)</span>. This process effectively captures the dynamic progression of the system.</p>
<p>The key property of the Koopman operator <span class="math notranslate nohighlight">\(\mathcal{K}\)</span> is its <em>linearity</em>. This linearity holds irrespective of whether the system’s dynamics are linear or nonlinear. Consequently, the spectral properties of <span class="math notranslate nohighlight">\(\mathcal{K}\)</span> become a powerful tool in analyzing the dynamical system’s behavior.</p>
<p>if <span class="math notranslate nohighlight">\(g \in \mathcal{F}\)</span> is an eigenfunction of <span class="math notranslate nohighlight">\(\mathcal{K}\)</span> with eigenvalue <span class="math notranslate nohighlight">\(\lambda\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[
g(\mathbf{x}_t) = [\mathcal{K}^t g](\mathbf{x}_0) = λ^t g(\mathbf{x}_0), \quad \forall n \in \mathbb{N}.
\]</div>
<p>One of the most useful features of Koopman operators is the Koopman Mode Decomposition (KMD).
The KMD expresses the state <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> or an observable <span class="math notranslate nohighlight">\(g(\mathbf{x})\)</span> as a linear combination of dominant coherent structures.
It can be considered a diagonalization of the Koopman operator.</p>
<p>As a result, the KMD is invaluable for tasks such as dimensionality and model reduction. It generalizes the space-time separation of variables typically achieved through the Fourier transformor singular value decomposition (SVD).</p>
</section>
<section id="dynamic-mode-decomposition-dmd">
<h3>Dynamic Mode Decomposition (DMD)<a class="headerlink" href="#dynamic-mode-decomposition-dmd" title="Link to this heading">#</a></h3>
<p>Dynamic Mode Decomposition (DMD) is a popular data-driven analysis technique used to decompose complex, nonlinear systems into a set of coherent structures (also  called DMD modes), that grow, decay, and/or oscillate in time revealing underlying patterns and dynamics through spectral analysis. In other words, the DMD converts a dynamical system into a superposition of modes whose dynamics are governed by eigenvalues.</p>
<p>The simplest and historically first interpretation of DMD is as a linear regression.</p>
<p>We consider a discrete-time dynamical systems represented as:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{x}_{t+1} = f(\mathbf{x}_t), \quad n = 0, 1, 2, \dots, 
\]</div>
<p>Given discrete-time snapshots of the system:</p>
<div class="math notranslate nohighlight">
\[
\{\mathbf{x}^{(m)}, \mathbf{y}^{(m)}\}^M_{m=1}, \quad \text{s.t.} \quad \mathbf{y}^{(m)} = f(\mathbf{x}^{(m)}), \quad m = 1, \dots , M.
\]</div>
<p>We define the snapshot matrices <span class="math notranslate nohighlight">\(\mathbf{X}, \mathbf{Y} \in \mathbb{C}^{d\times M}\)</span> as:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{X} = \begin{bmatrix}x^{(1)} &amp; x^{(2)} &amp; \dots &amp; x^{(M)} \end{bmatrix}
\]</div>
<div class="math notranslate nohighlight">
\[
\mathbf{Y} = \begin{bmatrix}y^{(1)} &amp; y^{(2)} &amp; \dots &amp; y^{(M)} \end{bmatrix}
\]</div>
<p>We seek a matrix <span class="math notranslate nohighlight">\(\mathbf{K}_{\text{DMD}}\)</span> such that <span class="math notranslate nohighlight">\(\mathbf{Y} \approx \mathbf{K}_{\text{DMD}} \mathbf{X}\)</span>. We can think
of this as constructing a linear and approximate dynamical system.</p>
<p>To find a suitable matrix KDMD, we consider the minimization problem:</p>
<div class="math notranslate nohighlight" id="equation-dmd-minimization">
<span class="eqno">(1)<a class="headerlink" href="#equation-dmd-minimization" title="Link to this equation">#</a></span>\[
\underset{\mathbf{K}_{\text{DMD}} \in \mathbb{C}^{d\times d} }{\min} \left\lVert \mathbf{Y} − \mathbf{K}_{\text{DMD}} \mathbf{X} \right\rVert_F ,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\left\lVert . \right\rVert_F\)</span> denotes the Frobenius norm<a class="footnote-reference brackets" href="#frobenius" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. Similar optimization problems will be at the heart of the
various DMD-type algorithms we consider in this review. A solution to the problem in <a class="reference internal" href="#equation-dmd-minimization">(1)</a> is:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{K}_{\text{DMD}} = \mathbf{Y} \mathbf{X}^{+} ∈ \mathbb{C}^{d\times d},
\]</div>
<p>where <span class="math notranslate nohighlight">\(^{+}\)</span> denotes the Moore–Penrose pseudoinverse.</p>
<p>In practice, this is computed using the Singular Value Decomposition (SVD) as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{ll}
\mathbf{X} \approx U \Sigma V^∗ &amp; \text{(truncated SVD of rank r)}\\
\tilde{\mathbf{K}}_{\text{DMD}} = U^∗\mathbf{Y} V \Sigma^{-1} &amp; \text{(Compute compression)}\\
\tilde{\mathbf{K}}_{\text{DMD}} W = W \Lambda &amp; \text{(Compute eigendecomposition)}\\
\phi = YV\Sigma^{-1}W &amp; \text{(Compute the modes)}\\
\end{array}
\end{split}\]</div>
<p>The core goal of DMD is to apply linear algebra and spectral techniques to the analysis, prediction, and control of nonlinear dynamical systems.
However, DMD often faces several challenges that have been a driving force for the many versions of the DMD algorithm that have appeared.</p>
<p>Generally speaking, the error of DMD and its approximate KMD can be split into three types:</p>
<ul class="simple">
<li><p>The projection error is due to projecting/truncating the Koopman operator onto a finite-dimensional space of observables. This is linked to the issue of    closure and lack of (or lack of knowledge of) non-trivial finite-dimensional Koopman invariant subspaces.</p></li>
<li><p>The estimation error is due to estimating the matrices that represent the projected Koopman operator from a finite set of potentially noisy trajectory data.</p></li>
<li><p>Numerical errors (e.g., roundoff, stability, further compression, etc.) incurred when processing the finite DMD matrix.</p></li>
</ul>
<section id="variants">
<h4>Variants<a class="headerlink" href="#variants" title="Link to this heading">#</a></h4>
<table class="table table-center" id="id19">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Summary of some DMD methods. <em>Adapted from <span id="id9">[<a class="reference internal" href="home.html#id10" title="Matthew J. Colbrook. The Multiverse of Dynamic Mode Decomposition Algorithms. November 2023. doi:10.48550/arXiv.2312.00137.">Col23</a>]</span></em>.</span><a class="headerlink" href="#id19" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>DMD Method</p></th>
<th class="head"><p>Challenges Overcome</p></th>
<th class="head"><p>Key Insight/Development</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Forward-Backward DMD</p></td>
<td><p>Sensor noise bias.</p></td>
<td><p>Take geometric mean of forward and backward propagators for the data.</p></td>
</tr>
<tr class="row-odd"><td><p>Total Least-Squares DMD</p></td>
<td><p>Sensor noise bias.</p></td>
<td><p>Replace least-squares problem with total least-squares problem.</p></td>
</tr>
<tr class="row-even"><td><p>Optimized DMD<br>Bagging Optimized DMD</p></td>
<td><p>Sensor noise bias.<br>Optimal collective processing of snapshots.</p></td>
<td><p>Exponential fitting problem, solve using variable projection method.<br>Statistical bagging sampling strategy.</p></td>
</tr>
<tr class="row-odd"><td><p>Compressed Sensing</p></td>
<td><p>Computational efficiency.<br>Temporal or spatial undersampling.</p></td>
<td><p>Unitary invariance of DMD extended to settings of compressed sensing (e.g., RIP, sparsity-promoting regularizers).</p></td>
</tr>
<tr class="row-even"><td><p>Randomized DMD</p></td>
<td><p>Computational efficiency.<br>Memory usage.</p></td>
<td><p>Sketch data matrix for computations in reduced-dimensional space.</p></td>
</tr>
<tr class="row-odd"><td><p>Multiresolution DMD</p></td>
<td><p>Multiscale dynamics.</p></td>
<td><p>Filtered decomposition across scales.</p></td>
</tr>
<tr class="row-even"><td><p><strong>DMD with Control</strong></p></td>
<td><p>Separation of unforced dynamics and actuation.</p></td>
<td><p>Generalized regression for globally linear control framework.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Extended DMD</strong></p></td>
<td><p>Nonlinear observables.</p></td>
<td><p>Arbitrary (nonlinear) dictionaries, recasting of DMD as a Galerkin method.</p></td>
</tr>
<tr class="row-even"><td><p>Physics-Informed DMD</p></td>
<td><p>Preserving structure of dynamical systems.<br>Numerous instances given in general framework.</p></td>
<td><p>Restrict the least-squares optimization to lie on a matrix manifold.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dmd-with-control-dmdc">
<h4>DMD with Control (DMDc)<a class="headerlink" href="#dmd-with-control-dmdc" title="Link to this heading">#</a></h4>
<figure class="align-default" id="id20">
<a class="reference internal image-reference" href="../_images/70_dmdc_overview.svg"><img alt="../_images/70_dmdc_overview.svg" src="../_images/70_dmdc_overview.svg" width="90%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 22 </span><span class="caption-text">Overview of Dynamic Mode Decomposition with Control (DMDc). <em>Adapted from <span id="id10">[<a class="reference internal" href="home.html#id26" title="Joshua L. Proctor, Steven L. Brunton, and J. Nathan Kutz. Dynamic Mode Decomposition with Control. SIAM Journal on Applied Dynamical Systems, 15(1):142–161, January 2016. doi:10.1137/15M1013857.">PBK16</a>]</span></em>.</span><a class="headerlink" href="#id20" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>One of the most successful applications of the Koopman operator framework lies in control with demonstrated successes in various challenging appli-
cations. These include fluid dynamics, robotics, power grids, biology, and chemical processes.</p>
<p>The key point is that Koopman operators represent nonlinear dynamics within a globally linear framework. This approach leads to tractable convex optimization problems and circumvents theoretical and computational limitations associated with nonlinearity. Moreover, it is amenable to data-driven, model-free approaches.</p>
<p>DMDc extends DMD to disambiguate between unforced dynamics and the effect of actuation.</p>
<p>The DMD regression is generalized to:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{x}_{t+1} = f(\mathbf{x}_t, \mathbf{u}_t) \approx A \mathbf{x}_t + B \mathbf{u}_t
\]</div>
<p>where <span class="math notranslate nohighlight">\(A \in \mathbb{C}^{d\times d}\)</span> and $B \in \mathbb{C}^{d\times q} are unknown matrices.</p>
<p>Snapshot triplets of the form <span class="math notranslate nohighlight">\(\{\mathbf{x}^{(m)}, \mathbf{y}^{(m)}, \mathbf{u}^{(m)}\}^M_{m=1}\)</span> are collected, where we assume that:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{y}^{(m)} \approx f(\mathbf{x}^{(m)}, \mathbf{u}^{(m)}), \quad m = 1, \dots , M.
\]</div>
<p>The control portion of the snapshots is arranged into the matrix <span class="math notranslate nohighlight">\(\Upsilon = \begin{pmatrix}u^{(1)} &amp; u^{(2)} &amp; \dots &amp; u^{(M)}\end{pmatrix}\)</span>.</p>
<p>The optimization problem in <a class="reference internal" href="#equation-dmd-minimization">(1)</a> is replaced by</p>
<div class="math notranslate nohighlight" id="equation-dmdc-minimization">
<span class="eqno">(2)<a class="headerlink" href="#equation-dmdc-minimization" title="Link to this equation">#</a></span>\[\begin{split}
\underset{A, B}{\min} \left\lVert \mathbf{Y} − \begin{pmatrix}A &amp; B \end{pmatrix}\Omega \right\rVert_F^2,\\
\text{where} \quad \Omega = \begin{pmatrix}\mathbf{X} \\ \Upsilon\end{pmatrix} 
\end{split}\]</div>
<p>A solution is given as <span class="math notranslate nohighlight">\(\begin{pmatrix}A &amp; B \end{pmatrix} = \mathbf{Y} \Omega^{+}\)</span>.</p>
</section>
</section>
<section id="comparison">
<h3>Comparison<a class="headerlink" href="#comparison" title="Link to this heading">#</a></h3>
<figure class="align-default" id="id21">
<a class="reference internal image-reference" href="../_images/70_comparison_identification_methods.svg"><img alt="../_images/70_comparison_identification_methods.svg" src="../_images/70_comparison_identification_methods.svg" width="80%" /></a>
<figcaption>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">Overview of various methods that use regression to identify dynamics from data. <em>Taken from <span id="id11">[<a class="reference internal" href="home.html#id8" title="Steven L. Brunton, Joshua L. Proctor, and J. Nathan Kutz. Sparse Identification of Nonlinear Dynamics with Control (SINDYc). https://arxiv.org/abs/1605.06682v1, May 2016.">BPK16b</a>]</span></em>.</span><a class="headerlink" href="#id21" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="application-to-systems">
<h1>Application to Systems<a class="headerlink" href="#application-to-systems" title="Link to this heading">#</a></h1>
<section id="id12">
<h2>Cart<a class="headerlink" href="#id12" title="Link to this heading">#</a></h2>
<p>We will use the DMDc and the SINDYc methods to fit a model on the data collected from the Cart environment.</p>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cart_env</span> <span class="o">=</span> <span class="n">create_cart_environment</span><span class="p">(</span><span class="n">max_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">goal_position</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">max_position</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">cart_observations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cart_actions</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">controllers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Step&quot;</span><span class="p">:</span> <span class="n">ConstantController</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">cart_env</span><span class="o">.</span><span class="n">max_action</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])),</span>
    <span class="s2">&quot;Schroeder Sweep&quot;</span><span class="p">:</span> <span class="n">SchroederSweepController</span><span class="p">(</span>
        <span class="n">cart_env</span><span class="p">,</span>
        <span class="n">n_time_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">n_harmonics</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;PRBS&quot;</span><span class="p">:</span> <span class="n">PRBSController</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">cart_env</span><span class="o">.</span><span class="n">max_action</span><span class="p">])),</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">controller_name</span><span class="p">,</span> <span class="n">controller</span> <span class="ow">in</span> <span class="n">controllers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">simulate_environment</span><span class="p">(</span><span class="n">cart_env</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">)</span>
    <span class="n">cart_observations</span><span class="p">[</span><span class="n">controller_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">observations</span>
    <span class="n">cart_actions</span><span class="p">[</span><span class="n">controller_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">actions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>error: XDG_RUNTIME_DIR not set in the environment.
</pre></div>
</div>
</div>
</details>
</div>
<p>We use the data from the PRBS controller as training data and use the one from the Step controller as validation data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">training_controller_name</span> <span class="o">=</span> <span class="s2">&quot;PRBS&quot;</span>
<span class="n">testing_controller_name</span> <span class="o">=</span> <span class="s2">&quot;Step&quot;</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">cart_observations</span><span class="p">[</span><span class="n">training_controller_name</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">U_train</span> <span class="o">=</span> <span class="n">cart_actions</span><span class="p">[</span><span class="n">training_controller_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">t_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span> <span class="o">*</span> <span class="n">cart_env</span><span class="o">.</span><span class="n">dt</span>

<span class="n">X_val</span> <span class="o">=</span> <span class="n">cart_observations</span><span class="p">[</span><span class="n">testing_controller_name</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">U_val</span> <span class="o">=</span> <span class="n">cart_actions</span><span class="p">[</span><span class="n">testing_controller_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">t_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span> <span class="o">*</span> <span class="n">cart_env</span><span class="o">.</span><span class="n">dt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sindyc">
<h3>SINDYc<a class="headerlink" href="#sindyc" title="Link to this heading">#</a></h3>
<p>For the SINDYc method we use the <a class="reference external" href="https://github.com/dynamicslab/pysindy">pysindy</a> package.</p>
<p>Refer to its <a class="reference external" href="https://pysindy.readthedocs.io/en/latest/examples/2_introduction_to_sindy/example.html">introduction</a> page for usage information.</p>
<p>We define an optimizer, a feature library and a differentiation method with appropriate hyper-parameters and then fit the model on the training data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">STLSQ</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">feature_library</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">IdentityLibrary</span><span class="p">()</span>
<span class="n">differentiation_method</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">FiniteDifference</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sindy_model</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">SINDy</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">feature_library</span><span class="o">=</span><span class="n">feature_library</span><span class="p">,</span>
    <span class="n">differentiation_method</span><span class="o">=</span><span class="n">differentiation_method</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sindy_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">U_train</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>SINDy(differentiation_method=FiniteDifference(order=1),
      feature_library=&lt;pysindy.feature_library.identity_library.IdentityLibrary object at 0x7ff73ef01d80&gt;,
      feature_names=[&#x27;x0&#x27;, &#x27;x1&#x27;, &#x27;u0&#x27;], optimizer=STLSQ(max_iter=100))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">SINDy</label><div class="sk-toggleable__content"><pre>SINDy(differentiation_method=FiniteDifference(order=1),
      feature_library=&lt;pysindy.feature_library.identity_library.IdentityLibrary object at 0x7ff73ef01d80&gt;,
      feature_names=[&#x27;x0&#x27;, &#x27;x1&#x27;, &#x27;u0&#x27;], optimizer=STLSQ(max_iter=100))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">optimizer: STLSQ</label><div class="sk-toggleable__content"><pre>STLSQ(max_iter=100)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">STLSQ</label><div class="sk-toggleable__content"><pre>STLSQ(max_iter=100)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>Once that’s done, we can print the fitted model</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(x0)&#39; = 1.002 x1
(x1)&#39; = 0.980 u0
</pre></div>
</div>
</div>
</div>
<p>We can also compute a score for the fitted model.</p>
<p>By default this is computes the <span class="math notranslate nohighlight">\(R^2\)</span> score<a class="footnote-reference brackets" href="#r2" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>, also called coefficient of determination, but we will instead using the Mean Squared Error metric.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model score: 5.911230
</pre></div>
</div>
</div>
</div>
<p>Let us now use the model to simulate the system’s response with the test inputs and as initial state the first state in the test data</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_sindy</span> <span class="o">=</span> <span class="n">sindy_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_val</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">U_val</span><span class="p">)</span>
<span class="n">X_sindy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_sindy</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/8b8f08e031f58c6d9fdcd1ff3b71d06924104be22a54c6e5bdc1ea67ea017a74.png" src="../_images/8b8f08e031f58c6d9fdcd1ff3b71d06924104be22a54c6e5bdc1ea67ea017a74.png" />
</div>
</div>
</section>
<section id="dmdc">
<h3>DMDc<a class="headerlink" href="#dmdc" title="Link to this heading">#</a></h3>
<p>For the DMDc method we use the <a class="reference external" href="https://github.com/dynamicslab/pykoopman/">pykoopman</a> package.</p>
<p>Refer to its <a class="reference external" href="https://pykoopman.readthedocs.io/en/master/">documentation</a> page for usage information.</p>
<p>We start by defining a regression method, DMDs in this case, with appropriate hyper-parameters.</p>
<p>Afterwards we use that to create and then fit a model on the training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DMDc</span> <span class="o">=</span> <span class="n">pk</span><span class="o">.</span><span class="n">regression</span><span class="o">.</span><span class="n">DMDc</span><span class="p">(</span><span class="n">svd_output_rank</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">svd_rank</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">dmd_model</span> <span class="o">=</span> <span class="n">pk</span><span class="o">.</span><span class="n">Koopman</span><span class="p">(</span><span class="n">regressor</span><span class="o">=</span><span class="n">DMDc</span><span class="p">)</span>
<span class="n">dmd_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">U_train</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">cart_env</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Koopman(observables=Identity(), regressor=DMDc(svd_output_rank=4, svd_rank=6))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">Koopman</label><div class="sk-toggleable__content"><pre>Koopman(observables=Identity(), regressor=DMDc(svd_output_rank=4, svd_rank=6))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">observables: Identity</label><div class="sk-toggleable__content"><pre>Identity()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">Identity</label><div class="sk-toggleable__content"><pre>Identity()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">regressor: DMDc</label><div class="sk-toggleable__content"><pre>DMDc(svd_output_rank=4, svd_rank=6)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">DMDc</label><div class="sk-toggleable__content"><pre>DMDc(svd_output_rank=4, svd_rank=6)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>Once we fit the model we can access the linear state-space models matrices:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}A = \begin{bmatrix}1.010510751239029 &amp;-0.02863348988997971 \\0.006065974861300678 &amp;0.9879637714484827 \\\end{bmatrix}\end{equation*}\end{split}\]</div>
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}B = \begin{bmatrix}-0.01287051854881282 \\0.030159189580408505 \\\end{bmatrix}\end{equation*}\end{split}\]</div>
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}C = \begin{bmatrix}-0.9323152899742126 &amp;-0.36164650321006775 \\-0.36164650321006775 &amp;0.9323152899742126 \\\end{bmatrix}\end{equation*}\end{split}\]</div>
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}W = \begin{bmatrix}(-0.9762558892999682+0.0783197876731853j) &amp;(-0.9762558892999682-0.0783197876731853j) \\(0.0049251618999634345-0.20190637793290236j) &amp;(0.0049251618999634345+0.20190637793290236j) \\\end{bmatrix}\end{equation*}\end{split}\]</div>
</div>
</div>
<p>These matrices are different from the ones that we used in our model previously because they are acting on measurements and not on the actual states.</p>
<p>After that we can use the model to simulate the system using the test data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_dmd</span> <span class="o">=</span> <span class="n">dmd_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">U_val</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_dmd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_dmd</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.10/site-packages/pykoopman/koopman.py:302: ComplexWarning: Casting complex values to real discards the imaginary part
  x = x.astype(self.A.dtype)
</pre></div>
</div>
</div>
</div>
<p>We can also compute score similarily to what we did for SINDyc</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model score: 3.758127
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/f56f92148c6d79f2f5ac13f861c415869fada220b8837d2b316b0dfc2f1bd485.png" src="../_images/f56f92148c6d79f2f5ac13f861c415869fada220b8837d2b316b0dfc2f1bd485.png" />
</div>
</div>
</section>
</section>
<section id="inverted-pendulum">
<h2>Inverted Pendulum<a class="headerlink" href="#inverted-pendulum" title="Link to this heading">#</a></h2>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Link to this heading">#</a></h3>
<div class="exercise admonition" id="inverted-pendulum-data-model">

<p class="admonition-title"><span class="caption-number">Exercise 7 </span> (Inverted Pendulum)</p>
<section id="exercise-content">
<p>Use the SINDYc and/or DMDc method to fit a model on the data collected from the inverted pendulum environment.</p>
</section>
</div>
<div class="solution dropdown admonition" id="notebooks/nb_70_machine_learning_control-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#inverted-pendulum-data-model">  ( 7</a></p>
<section id="solution-content">
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inverted_pendulum_env</span> <span class="o">=</span> <span class="n">create_inverted_pendulum_environment</span><span class="p">(</span>
    <span class="n">max_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">theta_threshold</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="p">)</span>

<span class="n">inverted_pendulum_observations</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">inverted_pendulum_actions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">controllers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">controllers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;PRBS </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PRBSController</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">inverted_pendulum_env</span><span class="o">.</span><span class="n">force_max</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)]),</span> <span class="n">seed</span><span class="o">=</span><span class="n">i</span>
    <span class="p">)</span>

<span class="k">for</span> <span class="n">controller_name</span><span class="p">,</span> <span class="n">controller</span> <span class="ow">in</span> <span class="n">controllers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">simulate_environment</span><span class="p">(</span><span class="n">inverted_pendulum_env</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">)</span>
    <span class="n">inverted_pendulum_observations</span><span class="p">[</span><span class="n">controller_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">observations</span>
    <span class="n">inverted_pendulum_actions</span><span class="p">[</span><span class="n">controller_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">actions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>error: XDG_RUNTIME_DIR not set in the environment.
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/b0e68924845b6c765dd0d1a81ad24de07b5c1d72192b873c58fff59109e7f2d8.png" src="../_images/b0e68924845b6c765dd0d1a81ad24de07b5c1d72192b873c58fff59109e7f2d8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">training_controller_name</span> <span class="o">=</span> <span class="s2">&quot;PRBS 0&quot;</span>
<span class="n">testing_controller_name</span> <span class="o">=</span> <span class="s2">&quot;PRBS 1&quot;</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">inverted_pendulum_observations</span><span class="p">[</span><span class="n">training_controller_name</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">U_train</span> <span class="o">=</span> <span class="n">inverted_pendulum_actions</span><span class="p">[</span><span class="n">training_controller_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">t_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span> <span class="o">*</span> <span class="n">inverted_pendulum_env</span><span class="o">.</span><span class="n">dt</span>

<span class="n">X_val</span> <span class="o">=</span> <span class="n">inverted_pendulum_observations</span><span class="p">[</span><span class="n">testing_controller_name</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">U_val</span> <span class="o">=</span> <span class="n">inverted_pendulum_actions</span><span class="p">[</span><span class="n">testing_controller_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">t_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span> <span class="o">*</span> <span class="n">inverted_pendulum_env</span><span class="o">.</span><span class="n">dt</span>
</pre></div>
</div>
</div>
</div>
<p><strong>SINDYc</strong></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">STLSQ</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">feature_library</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">IdentityLibrary</span><span class="p">()</span>

<span class="n">differentiation_method</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">FiniteDifference</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sindy_model</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">SINDy</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">feature_library</span><span class="o">=</span><span class="n">feature_library</span><span class="p">,</span>
    <span class="n">differentiation_method</span><span class="o">=</span><span class="n">differentiation_method</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sindy_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">U_train</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">inverted_pendulum_env</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>SINDy(differentiation_method=FiniteDifference(order=1),
      feature_library=&lt;pysindy.feature_library.identity_library.IdentityLibrary object at 0x7ff73efa0a30&gt;,
      feature_names=[&#x27;x0&#x27;, &#x27;x1&#x27;, &#x27;x2&#x27;, &#x27;x3&#x27;, &#x27;u0&#x27;],
      optimizer=STLSQ(max_iter=500, threshold=0.3))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">SINDy</label><div class="sk-toggleable__content"><pre>SINDy(differentiation_method=FiniteDifference(order=1),
      feature_library=&lt;pysindy.feature_library.identity_library.IdentityLibrary object at 0x7ff73efa0a30&gt;,
      feature_names=[&#x27;x0&#x27;, &#x27;x1&#x27;, &#x27;x2&#x27;, &#x27;x3&#x27;, &#x27;u0&#x27;],
      optimizer=STLSQ(max_iter=500, threshold=0.3))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">optimizer: STLSQ</label><div class="sk-toggleable__content"><pre>STLSQ(max_iter=500, threshold=0.3)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">STLSQ</label><div class="sk-toggleable__content"><pre>STLSQ(max_iter=500, threshold=0.3)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(x0)&#39; = 0.998 x1
(x1)&#39; = -51.462 x0 + -1.826 x1 + -5.233 x2 + -0.885 x3 + 0.651 u0
(x2)&#39; = 1.001 x3
(x3)&#39; = -107.086 x0 + -5.116 x1 + -12.393 x2 + -0.517 x3 + -0.698 u0
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model score: 32.144658
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_sindy</span> <span class="o">=</span> <span class="n">sindy_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_val</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">U_val</span><span class="p">)</span>
<span class="n">X_sindy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_sindy</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/9ea45f9334abfd0df55123aff8739678e160dc20e0544e65d5070a8bc85423c2.png" src="../_images/9ea45f9334abfd0df55123aff8739678e160dc20e0544e65d5070a8bc85423c2.png" />
</div>
</div>
<p><strong>DMDc</strong></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regressor</span> <span class="o">=</span> <span class="n">pk</span><span class="o">.</span><span class="n">regression</span><span class="o">.</span><span class="n">EDMDc</span><span class="p">()</span>
<span class="n">observables</span> <span class="o">=</span> <span class="n">pk</span><span class="o">.</span><span class="n">observables</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dmd_model</span> <span class="o">=</span> <span class="n">pk</span><span class="o">.</span><span class="n">Koopman</span><span class="p">(</span><span class="n">observables</span><span class="o">=</span><span class="n">observables</span><span class="p">,</span> <span class="n">regressor</span><span class="o">=</span><span class="n">regressor</span><span class="p">)</span>
<span class="n">dmd_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">U_train</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">inverted_pendulum_env</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.10/site-packages/sklearn/utils/deprecation.py:103: FutureWarning: The attribute `n_input_features_` was deprecated in version 1.0 and will be removed in 1.2.
  warnings.warn(msg, category=FutureWarning)
/opt/conda/lib/python3.10/site-packages/sklearn/utils/deprecation.py:103: FutureWarning: The attribute `n_input_features_` was deprecated in version 1.0 and will be removed in 1.2.
  warnings.warn(msg, category=FutureWarning)
/opt/conda/lib/python3.10/site-packages/sklearn/utils/deprecation.py:103: FutureWarning: The attribute `n_input_features_` was deprecated in version 1.0 and will be removed in 1.2.
  warnings.warn(msg, category=FutureWarning)
/opt/conda/lib/python3.10/site-packages/sklearn/utils/deprecation.py:103: FutureWarning: The attribute `n_input_features_` was deprecated in version 1.0 and will be removed in 1.2.
  warnings.warn(msg, category=FutureWarning)
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Koopman(observables=Polynomial(degree=1), regressor=EDMDc())</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">Koopman</label><div class="sk-toggleable__content"><pre>Koopman(observables=Polynomial(degree=1), regressor=EDMDc())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">observables: Polynomial</label><div class="sk-toggleable__content"><pre>Polynomial(degree=1)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">Polynomial</label><div class="sk-toggleable__content"><pre>Polynomial(degree=1)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">regressor: EDMDc</label><div class="sk-toggleable__content"><pre>EDMDc()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">EDMDc</label><div class="sk-toggleable__content"><pre>EDMDc()</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}A = \begin{bmatrix}0.999999999999963 &amp;-1.6207781644572705e-13 &amp;-6.5658741464635906e-15 &amp;-2.0557015291411407e-14 &amp;2.6151024162986147e-15 \\-1.165458063723047e-09 &amp;0.9999999964558379 &amp;0.020000001184556554 &amp;-6.244138547104919e-10 &amp;3.7563398753760245e-10 \\-0.08739214280376793 &amp;-1.0721709694682215 &amp;0.9476892092479134 &amp;-0.11251502064813125 &amp;-0.00922556696486635 \\5.0851957901859835e-09 &amp;-1.019768218902813e-08 &amp;-3.243666745672972e-10 &amp;0.9999999990662863 &amp;0.019999999431521833 \\0.027640755572805417 &amp;-2.1680865930988924 &amp;-0.08973096067741987 &amp;-0.2439059002560893 &amp;0.9839030164862272 \\\end{bmatrix}\end{equation*}\end{split}\]</div>
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}B = \begin{bmatrix}-5.082739784612045e-16 \\-9.7208605406143e-11 \\0.012240554215487356 \\1.654690707668953e-09 \\-0.014546219966763462 \\\end{bmatrix}\end{equation*}\end{split}\]</div>
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}C = \begin{bmatrix}0.0 &amp;1.0 &amp;0.0 &amp;0.0 &amp;0.0 \\0.0 &amp;0.0 &amp;1.0 &amp;0.0 &amp;0.0 \\0.0 &amp;0.0 &amp;0.0 &amp;1.0 &amp;0.0 \\0.0 &amp;0.0 &amp;0.0 &amp;0.0 &amp;1.0 \\\end{bmatrix}\end{equation*}\end{split}\]</div>
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{equation*}W = \begin{bmatrix}(-0.007950742882235143-0.0539261529692824j) &amp;(-0.007950742882235143+0.0539261529692824j) &amp;(-0.08185125670261548-0.0021262378238662964j) &amp;(-0.08185125670261548+0.0021262378238662964j) &amp;(-0.11043983363884793+0j) \\(0.43942433872018216+0.030507373741592934j) &amp;(0.43942433872018216-0.030507373741592934j) &amp;(0.00015945250410232402-0.06714666035158207j) &amp;(0.00015945250410232402+0.06714666035158207j) &amp;(1.5988447853804014e-08+0j) \\(-0.023554399050895656-0.10750223627039948j) &amp;(-0.023554399050895656+0.10750223627039948j) &amp;(0.7688918882785541+0j) &amp;(0.7688918882785541+0j) &amp;(0.9907039819515358+0j) \\(0.8893215199709776+0j) &amp;(0.8893215199709776+0j) &amp;(0.01487734526015245+0.6303737623068534j) &amp;(0.01487734526015245-0.6303737623068534j) &amp;(-3.025819262328861e-08+0j) \\\end{bmatrix}\end{equation*}\end{split}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_dmd</span> <span class="o">=</span> <span class="n">dmd_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">U_val</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_dmd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X_val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_dmd</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.10/site-packages/sklearn/utils/deprecation.py:103: FutureWarning: The attribute `n_input_features_` was deprecated in version 1.0 and will be removed in 1.2.
  warnings.warn(msg, category=FutureWarning)
/opt/conda/lib/python3.10/site-packages/pykoopman/koopman.py:302: ComplexWarning: Casting complex values to real discards the imaginary part
  x = x.astype(self.A.dtype)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model score: 11.334027
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/01d3e39ac8c72f1ca744f078276b22e28c4361e2d27330f5d89107b3d9daee1f.png" src="../_images/01d3e39ac8c72f1ca744f078276b22e28c4361e2d27330f5d89107b3d9daee1f.png" />
</div>
</div>
</section>
</div>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>The step response of a dynamic system is its output when presented with an input signal, called step, that changes from 0 to a constant values in a very short amount of time.</p>
</aside>
<aside class="footnote brackets" id="id15" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>The impulse response of a dynamic system is its output when presented with a brief input signal, called an impulse. Any LTI system can be uniquely characterized by its impulse response</p>
</aside>
<aside class="footnote brackets" id="id16" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>A phase portrait is a geometric representation of the trajectories of a dynamical system in the phase plane. Each set of initial conditions is represented by a different curve, or point.</p>
</aside>
<aside class="footnote brackets" id="frobenius" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">4</a><span class="fn-bracket">]</span></span>
<p>The Frobenius norm of a matrix <span class="math notranslate nohighlight">\(\mathbf{X} \in \mathbb{C}^{m\times n}\)</span> is defined as <span class="math notranslate nohighlight">\(\left\lVert \mathbf{X} \right\rVert_F = \sqrt{\sum_{i=0}^{m} \sum_{j=0}^{n} x_{i,j}}\)</span></p>
</aside>
<aside class="footnote brackets" id="r2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">5</a><span class="fn-bracket">]</span></span>
<p><span class="math notranslate nohighlight">\(R^2\)</span> values range from 0 to 1. An R-Squared value of 0 means that the model explains or predicts 0% of the relationship between the dependent and independent variables. A value of 1 indicates that the model predicts 100% of the relationship.</p>
</aside>
</aside>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="nb_60_MCTS.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">MPC and AlphaZero</p>
      </div>
    </a>
    <a class="right-next"
       href="nb_80_safe_learning_control.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Safe Learning in Robotics</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Machine Learning &amp; Control</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-based-control">Learning-Based Control</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#system-identification">System Identification</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-collection">Data Collection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cart">Cart</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-fitting">Model Fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-deep-learning">Naive Deep Learning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deep-learning-with-nominal-model">Deep Learning with Nominal Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sparse-identification-of-nonlinear-dynamics-sindy">Sparse Identification of Nonlinear Dynamics (SINDy)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sindy-with-control-sindyc">SINDy with Control (SINDyc)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#koopman-operator">Koopman Operator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-mode-decomposition-dmd">Dynamic Mode Decomposition (DMD)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#variants">Variants</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dmd-with-control-dmdc">DMD with Control (DMDc)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison">Comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-to-systems">Application to Systems</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Cart</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sindyc">SINDYc</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dmdc">DMDc</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inverted-pendulum">Inverted Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By appliedAI TransferLab
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>